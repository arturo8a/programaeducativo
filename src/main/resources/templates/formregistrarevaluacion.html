<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>ProgramaEducativo</title>
    <script type="text/javascript">
		window.history.forward();
	</script>

    <!-- Bootstrap CSS CDN -->
    <link rel="stylesheet" href="../static/css/bootstrap.min.css" th:href="@{/css/bootstrap.min.css}">
    <!-- Our Custom CSS -->
    <link rel="stylesheet" href="../static/css/style.css" th:href="@{/css/style.css}">
	
	<script type="text/javascript" th:src="@{/js/jquery-3.3.1.js}" ></script>
    <script type="text/javascript" th:src="@{/js/bootstrapv4.js}" ></script>
    <script type="text/javascript" th:src="@{/js/jquery-ui.js}" ></script>
	
	<script type="text/javascript" th:src="@{/js/jquery-ui.js}" ></script>
	
	<link rel="stylesheet" href="../static/css/style.css" th:href="@{/css/style.css}">   
</head>
<body>
		<input type="hidden" id="id_rubrica" name="id_rubrica" th:value="${id_rubrica}" />
		<input type="hidden" id="id_questionario" name="id_questionario" th:value="${id_questionario}" />
		<input type="hidden" id="id_evaluacion" name="id_evaluacion" th:value="${id_evaluacion}" />
		<div class="row">
			<div class="col-xs-12 col-sm-3 text-left">
				<label for="nommbretrabajo">Nombre de Trabajo:</label>
			</div>
			<div class="col-xs-12 col-sm-3 text-left">
				<label for="nommbretrabajoDesc" th:utext="${nombretrabajo}"></label>
			</div>
			<div class="col-xs-12 col-sm-3 text-left">
				<label for="categoria">Categoría:</label>
			</div>
			<div class="col-xs-12 col-sm-3 text-left">
				<label for="categoriaDesc" th:utext="${categoria}"></label>
			</div>
			<div class="col-xs-12 col-sm-3 text-left">
				<label for="nivel">Nivel de Participación:</label>
			</div>
			<div class="col-xs-12 col-sm-3 text-left">
				<label for="nivelDesc" th:utext="${nivel}"></label>
			</div>
			<div class="col-xs-12 col-sm-3 text-left">
				<label for="modalidad">Modalidad:</label>
			</div>
			<div class="col-xs-12 col-sm-3 text-left">
				<label for="modalidadDesc" th:utext="${modalidad}"></label>
			</div>
		</div>
		<br>
		<div th:each="objeto : ${listarubrica}">
					<div>
						<div class="row" style="background-color:#EFEFEF">
							<div class="col-xs-12 col-sm-10 text-right">
								<table>
									<tr>
										<td>
											<label style="margin:5px" th:utext="${objeto.rubrica}"></label>
										</td>
									</tr>
								</table>
							</div>
							<div class="col-xs-12 col-sm-6 col-md-3">
								<label th:utext="${objeto.criterio1}"></label>
								<br>
								<textarea rows="3" style="width:100%" th:id="'descripcion' + ${objeto.id} + '1'" th:text="${objeto.descripcion1}" class="form-control" readonly>
								</textarea> 
								<br>
								<input type="radio" th:id="'respuesta'+ ${objeto.id} + '1'" th:value="${objeto.puntaje1}" th:name="'pregunta'+ ${objeto.id}" class="form-control" />				
							</div>
							<div class="col-xs-12 col-sm-6 col-md-3">
								<label th:utext="${objeto.criterio2}"></label>
								<br>
								<textarea rows="3" style="width:100%" th:id="'descripcion' + ${objeto.id} + '2'" th:text="${objeto.descripcion2}" class="form-control" readonly>
								</textarea>
								<br>
								<input type="radio" th:id="'respuesta'+ ${objeto.id} + '2'" th:value="${objeto.puntaje2}" th:name="'pregunta'+ ${objeto.id}" class="form-control" />
							</div>
							<div class="col-xs-12 col-sm-6 col-md-3">
								<label th:utext="${objeto.criterio3}"></label>								
								<br>
								<textarea rows="3" style="width:100%" th:id="'descripcion' + ${objeto.id} + '3'" th:text="${objeto.descripcion3}" class="form-control" readonly>
								</textarea>
								<br>
								<input type="radio" th:id="'respuesta'+ ${objeto.id} + '3'" th:value="${objeto.puntaje3}" th:name="'pregunta'+ ${objeto.id}" class="form-control" />
							</div>
							<div class="col-xs-12 col-sm-6 col-md-3">
								<label th:utext="${objeto.criterio4}"></label>
								<br>
								<textarea rows="3" style="width:100%" th:id="'descripcion' + ${objeto.id} + '4'" th:text="${objeto.descripcion4}" class="form-control" readonly>
								</textarea>
								<br>
								<input type="radio" th:id="'respuesta'+ ${objeto.id} + '4'" th:value="${objeto.puntaje4}" th:name="'pregunta'+ ${objeto.id}" class="form-control" />
							</div>
						</div>
					</div>			
					<br>
		</div>
		<div th:each="objeto : ${listaquestionario}">					
					<div class="row" style="background-color:#EFEFEF">
						<div class="col-xs-12 col-sm-12">
							<table style="width:100%">
								<tr>
									<td>
										<!--<label th:text="${objeto.pregunta}">Ingrese pregunta</label>-->
										<input type="text" class="form-control" th:id="'pregunta'+ ${objeto.id}" th:value="${objeto.pregunta}" disabled/>
									</td>
									<td>&nbsp;</td>
								</tr>
								<tr th:each="qr : ${objeto.questionariorespuesta}">
									<td>
										<input type="text" class="form-control" th:id="'respuesta'+ ${qr.id}" th:value="${qr.respuesta}" disabled/>
									</td>
									<td>
										<label>Puntaje</label>
										<input type="radio" class="form-control" th:id="'puntajeq'+ ${qr.id}" th:value="${qr.puntaje}"/>
									</td>
								</tr>							
							</table>						
						</div>
					</div>
		</div>
		<br>
		<div class="row text-right">
			<div class="col-xs-6 col-sm-6">
				&nbsp;
			</div>
			<div class="col-xs-6 col-sm-6">
				<input type="button" name="btneditarevaluacion" id="btneditarevaluacion" value="Enviar" class="btn btn-primary"/>
				<input type="button" name="btncerrarevaluacion" id="btncerrarevaluacion" value="Cerrar" class="btn btn-outline-primary"/>
			</div>
		</div>
		
	<div class="modal" tabindex="-1" role="dialog" id="modalimagencargando">
	  <center>
	  	<img th:src="@{./images/cargando.gif}" style="line-height: 200px;"/>
	  </center>	  
	</div>	
	
	<div class="modal" tabindex="-1" role="dialog" id="modalexitoeditevaluacion">
	  <div class="modal-dialog" role="document">
	    <div class="modal-content">
	      <div class="modal-header">
	        <img th:src="@{./images/imagen_exito5.png}"/>&nbsp;&nbsp; <strong class="pt-1">Registro exitoso</strong>
	      </div>
	      <div class="modal-body" id="textoexitoeditevaluacion">
	      </div>
	      <div class="modal-footer">
	        <button type="button" class="btn btn-primary rounded-0" id="btncerrarmensajeexitoeditevaluacion" name="btncerrarmensajeexitoeditevaluacion">Aceptar</button>
	      </div>
	    </div>
	  </div>
	</div>
	
	
	<div class="modal" tabindex="-1" role="dialog" id="modalerroreditevaluacion">
	  <div class="modal-dialog" role="document">
	    <div class="modal-content">
	      <div class="modal-header">
	        <img th:src="@{./images/imagen_informacion11.png}"/>&nbsp;&nbsp; <strong class="pt-1">Error</strong>
	        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
	          <span aria-hidden="true">&times;</span>	          
	        </button>
	      </div>
	      <div class="modal-body" id="textoerroreditevaluacion">
	      </div>
	      <div class="modal-footer">
	        <button type="button" class="btn btn-outline-primary" id="btncerrarmensajeerroreditevaluacion" name="btncerrarmensajeerroreditevaluacion">Cerrar</button>
	      </div>
	    </div>
	  </div>
	</div>
	
	<div class="modal" tabindex="-1" role="dialog" id="modalinformacioneditevaluacion">
	  <div class="modal-dialog" role="document">
	    <div class="modal-content">
	      <div class="modal-header">
	        <img th:src="@{./images/imagen_informacion11.png}" />&nbsp;&nbsp; <label class="pt-1" style="padding-right:380px">Alerta</label>
	      </div>
	      <div class="modal-body" id="textoinformacioneditevaluacion">
	      </div>
	      <div class="modal-footer">
	        <button type="button" class="btn btn-outline-primary" id="btncerrarmensajeinformacioneditevaluacion" name="btncerrarmensajeinformacioneditevaluacion">Cerrar</button>
	      </div>
	    </div>
	  </div>
	</div>
	
</body>
</html>
<script type="text/javascript">
	
		var mensajeValidacionedit = "";
		var anioedit;
		var categoriaedit;
		var nivelparticipacionedit;
		var id_evaluacionedit;
		var array_rubricaedit , array_cuestionarioedit;
		var rubricaedit, criterio1edit, criterio2edit, criterio3edit, criterio4edit, criterio5edit, descripcion1edit, descripcion2edit, descripcion3edit, descripcion4edit, descripcion5edit,puntaje1edit, puntaje2edit, puntaje3edit, puntaje4edit, puntaje5edit;
		var preguntaedit, respuestaedit, puntajeedit;
		var id_rubricaedit , id_questionarioedit;

		
		$("#btncerrarmensajeexitoeditevaluacion").click(function(){			
			$("#modalexitoeditevaluacion").modal('hide');
			$("#modaleditarEvaluacion").modal('hide');
		});
		
		$("#btncerrarmensajeerroreditevaluacion").click(function(){			
			$("#modalerroreditevaluacion").modal('hide');
		});
		
		$("#btncerrarmensajeinformacioneditevaluacion").click(function(){			
			$("#modalinformacioneditevaluacion").modal('hide');
		});	
		
		$('#btncerrarevaluacion').click(function(){	
			$("#modaleEvaluarTrabajoPendientes").modal('hide');
		});
		
		$("#btneditarevaluacion").click(function(){	
			
			$("#modalimagencargando").modal({
				show : true,
				backdrop : 'static',
				keyboard:false
			});
			
			if(validarCamposedit()){
				
				id_rubricaedit = $("#id_rubrica").val();
				id_questionarioedit = $("#id_questionario").val();
				id_evaluacionedit = $("#id_evaluacion").val();
				
				id_rubricaedit = id_rubricaedit.split("-");
				
				array_rubricaedit = new Array();
				array_cuestionarioedit = new Array();
				
				for(var i=0;i<id_rubricaedit.length-1;i++){					
					rubrica = $("#rubrica"+id_rubrica[i]).val();
					criterio1edit = $("#criterio"+id_rubricaedit[i]+"1").val();
					criterio2edit = $("#criterio"+id_rubricaedit[i]+"2").val();
					criterio3edit = $("#criterio"+id_rubricaedit[i]+"3").val();
					criterio4edit = $("#criterio"+id_rubricaedit[i]+"4").val();
					criterio5edit = $("#criterio"+id_rubricaedit[i]+"5").val();
					descripcion1edit = $("#descripcion"+id_rubricaedit[i]+"1").val();
					descripcion2edit = $("#descripcion"+id_rubricaedit[i]+"2").val();
					descripcion3edit = $("#descripcion"+id_rubricaedit[i]+"3").val();
					descripcion4edit = $("#descripcion"+id_rubricaedit[i]+"4").val();
					descripcion5edit = $("#descripcion"+id_rubricaedit[i]+"5").val();
					puntaje1edit = $("#puntaje"+id_rubricaedit[i]+"1").val();
					puntaje2edit = $("#puntaje"+id_rubricaedit[i]+"2").val();
					puntaje3edit = $("#puntaje"+id_rubricaedit[i]+"3").val();
					puntaje4edit = $("#puntaje"+id_rubricaedit[i]+"4").val();
					puntaje5edit = $("#puntaje"+id_rubricaedit[i]+"5").val();
					
					array_rubricaedit.push({
						id : id_rubricaedit[i],
						rubrica : rubricaedit,
						criterio1 : criterio1edit,
						criterio2 : criterio2edit,
						criterio3 : criterio3edit,
						criterio4 : criterio4edit,
						criterio5 : criterio5edit,
						descripcion1 : descripcion1edit,
						descripcion2 : descripcion2edit,
						descripcion3 : descripcion3edit,
						descripcion4 : descripcion4edit,
						descripcion5 : descripcion5edit,
						puntaje1 : puntaje1edit,
						puntaje2 : puntaje2edit,
						puntaje3 : puntaje3edit,
						puntaje4 : puntaje4edit,
						puntaje5 : puntaje5edit
					});
				}
				
				
				id_questionarioedit = id_questionarioedit.split("-");
				for(var i=0; i<id_questionarioedit.length-1;i++){					
					preguntaedit = $("#pregunta"+id_questionarioedit[i]+"1").val();
					respuestaedit = $("#respuesta"+id_questionarioedit[i]+"1").val();
					puntajeedit = $("#puntajeq"+id_questionarioedit[i]+"1").val();
					
					array_cuestionarioedit.push({
						id : id_questionarioedit[i],
						pregunta : preguntaedit,
						respuesta : respuestaedit, 
						puntaje : puntajeedit
					});			
				}
				
				var evaluaciondtoedit = {
					evaluacion : {
						id: id_evaluacionedit,
						anio : anioedit,
						categoriaevaluacion : {
							id : categoriaedit
						},
						nivelparticipacion : {
							id : nivelparticipacionedit
						},
						estadoevaluacion : {
							id : 1
						},
						estado : 1
					},
					listarubrica: array_rubricaedit,
					listaquestionario : array_cuestionarioedit
				};
				
				$.ajax({
					type : "POST",
				    contentType : "application/json",
				    url : url_base + "pedesa/actualizarevaluacion",
				    data : JSON.stringify(evaluaciondtoedit),
				    dataType : 'json',
					success: function(respuesta) {
						if(respuesta.id>0){
							
							$("#modalimagencargando").modal('hide');
							
							/*table_lista_evaluacion.row.add({
						        "id": respuesta.id,
						        "anio": anio,
						        "nivelparticipacion":  $("#nivelparticipacionce_edit option:selected").html(),
						        "categoriaevaluacion": $("#categoriace_edit option:selected").html(),
						        "estado": "Editando",
						        "defaultContent" : '<img src="./images/svg/file-pdf-regular.svg" class="archivo" style="width:20px; cursor:pointer"/>',
						        "defaultContent" : '<img src="./images/svg/edit-regular.svg" class="editar" style="width:20px; cursor:pointer" />',
						        "defaultContent" : '<img src="./images/svg/eliminar-alt-regular.svg" class="eliminar" style="width:20px; cursor:pointer" />'
						    }).draw();	*/
						    
						    table_lista_evaluacion.cell(celdaseleccionada,1).data(anioedit).draw();
						    table_lista_evaluacion.cell(celdaseleccionada,2).data($("#nivelparticipacionce_edit option:selected").html()).draw();
						    table_lista_evaluacion.cell(celdaseleccionada,3).data($("#categoriace_edit option:selected").html()).draw();
						    table_lista_evaluacion.cell(celdaseleccionada,4).data("Editando").draw();
						    /*table_lista_evaluacion.cell(celdaseleccionada,5).data().draw();
						    table_lista_evaluacion.cell(celdaseleccionada,6).data().draw();
						    table_lista_evaluacion.cell(celdaseleccionada,7).data().draw();*/
							
							limpiarControlesedit();
							$("#textoexitoeditevaluacion").html("Se actualizó evaluación");
							$('#modalexitoeditevaluacion').modal({
								show : true,
								backdrop : 'static',
								keyboard:false
							});
							
							
						}
						else{
							$("#modalimagencargando").modal('hide');
							$("#textoerroreditevaluacion").html("Error al actualizar evaluación");
							$('#modalerroreditevaluacion').modal({
								show : true,
								backdrop : 'static',
								keyboard:false
							});
						}
					},
					error: function() {
						$("#textoerroreditevaluacion").html("Excepción al registrar evaluación");
						$('#modalerroreditevaluacion').modal({
							show : true,
							backdrop : 'static',
							keyboard:false
						});
				    }
				});
			}
			else{
				$("#modalimagencargando").modal('hide');
				$("#textoinformacioneditevaluacion").html("<div style='color:red' class='text-left'>"+mensajeValidacion+"</div>");
				$('#modalinformacioneditrevaluacion').modal({
					show : true,
					backdrop : 'static',
					keyboard:false
				});
			}
		});
		
		function limpiarControlesedit(){
			$("#anioce_edit").val("");
			$("#categoriace_edit").val("");
			$("#nivelparticipacionce_edit").val("");
		}
		
		function validarCamposedit(){
			
			/*arrayParticipante = new Array()*/
			
			mensajeValidacionedit = "";
			anioedit = $("#anioce_edit").val();
			categoriaedit = $("#categoriace_edit").val();
			nivelparticipacionedit = $("#nivelparticipacionce_edit").val();
			
			if(anioedit == ""){
				mensajeValidacionedit += "Debe seleccionar Año"+"<br>";
			}
			
			if(categoriaedit==""){
				mensajeValidacionedit += "Debe seleccionar Categoria"+"<br>";
			}
			
			if(nivelparticipacionedit==""){
				mensajeValidacionedit += "Debe seleccionar Nivel de participación"+"<br>";
			}
			if(mensajeValidacionedit!=""){
				return false;
			}
			return true;
		}
		
</script>