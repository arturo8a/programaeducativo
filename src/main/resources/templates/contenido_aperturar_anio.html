<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>ProgramaEducativo</title>
    <script type="text/javascript">
		window.history.forward();
	</script>

    <!-- Bootstrap CSS CDN -->
    <!-- link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css" integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4" crossorigin="anonymous"-->
    <!-- Our Custom CSS -->
    <link rel="stylesheet" href="../static/css/style.css" th:href="@{/css/style.css}">
    <link rel="stylesheet" href="../static/css/nuevo_disenio.css" th:href="@{/css/nuevo_disenio.css}">
	
    <!-- Font Awesome JS -->
    <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/solid.js" integrity="sha384-tzzSw1/Vo+0N5UhStP3bvwWPq+uvzCMfrN1fEFe+xBmv1C/AtVX5K0uZtmcHitFZ" crossorigin="anonymous"></script>
    <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/fontawesome.js" integrity="sha384-6OIrr52G08NpOFSZdxxz1xdNSndlD4vdcf/q2myIUVO0VsqaGHJsB0RaBE01VTOY" crossorigin="anonymous"></script>
	
	<!-- jQuery CDN - Slim version (=without AJAX) -->
    <!-- script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script-->
    <!-- Popper.JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js" integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ" crossorigin="anonymous"></script>
    <!-- Bootstrap JS -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js" integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm" crossorigin="anonymous"></script>
	
	<link rel="stylesheet" href="../static/css/dataTables.bootstrap4.min.css" th:href="@{/css/dataTables.bootstrap4.min.css}">
	<link rel="stylesheet" href="../static/css/responsive.bootstrap4.min.css" th:href="@{/css/responsive.bootstrap4.min.css}">
	<link rel="stylesheet" href="../static/css/editor.dataTables.min.css" th:href="@{/css/editor.dataTables.min.css}">
	<link rel="stylesheet" href="../static/css/select.dataTables.min.css" th:href="@{/css/select.dataTables.min.css}">
	<link rel="stylesheet" href="../static/css/buttons.dataTables.min.css" th:href="@{/css/buttons.dataTables.min.css}">
	<link rel="stylesheet" href="../static/css/colReorder.dataTables.min.css" th:href="@{/css/colReorder.dataTables.min.css}">
	
	<script type="text/javascript" th:src="@{/js/jquery-3.3.1.js}" ></script>
    <script type="text/javascript" th:src="@{/js/bootstrapv4.js}" ></script>
    <script type="text/javascript" th:src="@{/js/fontawesomev5.0.6.js}" ></script>
    <script type="text/javascript" th:src="@{/js/jquery-ui.js}" ></script>
	
	<script type="text/javascript" th:src="@{/js/bootstrap-select.min.js}"></script>
    <script type="text/javascript" th:src="@{/js/fontawesomev5.0.6.js}"></script>
    <script type="text/javascript" th:src="@{/js/jquery.dataTables.min.js}"></script>
    <script type="text/javascript" th:src="@{/js/dataTables.editor.min.js}"></script>
    <script type="text/javascript" th:src="@{/js/dataTables.select.min.js}"></script>
    <script type="text/javascript" th:src="@{/js/dataTables.colReorder.min.js}"></script>
    <script type="text/javascript" th:src="@{/js/dataTables.buttons.min.js}"></script>
    <script type="text/javascript" th:src="@{/js/jszip.min.js}"></script>
    <script type="text/javascript" th:src="@{/js/pdfmake.min.js}"></script>
    <script type="text/javascript" th:src="@{/js/vfs_fonts.js}"></script>
    <script type="text/javascript" th:src="@{/js/buttons.html5.min.js}"></script>
    <script type="text/javascript" th:src="@{/js/buttons.print.min.js}"></script>
    <script type="text/javascript" th:src="@{/js/dataTables.bootstrap4.min.js}"></script>
    <script type="text/javascript" th:src="@{/js/dataTables.responsive.min.js}"></script>
    <script type="text/javascript" th:src="@{/js/responsive.bootstrap4.min.js}"></script>      
    <script type="text/javascript" th:src="@{/js/dataTables.editor.min.js}"></script>
    <script type="text/javascript" th:src="@{/js/datetime.js}"></script>
    <script type="text/javascript" th:src="@{/js/moment.min.js}"></script>
	<script type="text/javascript" th:src="@{/js/datetime-moment.js}"></script>
	
	<script type="text/javascript" th:src="@{/js/jquery-ui.js}" ></script>
	
	<link href="../static/css/gijgo.min.css" rel="stylesheet" th:href="@{/css/gijgo.min.css}" >
	<script type="text/javascript" th:src="@{/js/gijgo.min.js}" ></script>
	<script type="text/javascript" th:src="@{/js/messages.es-es.js}"></script>
	<script type="text/javascript" th:src="@{/js/datetime-moment-order.js}"></script>
	<script type="text/javascript" th:src="@{/js/moment.js}"></script>
	
	<script type="text/javascript" th:src="@{/js/date-uk.js}"></script>
	<script type="text/javascript" th:src="@{/js/date-euro.js}"></script>    
	
	<style>
		.rs_aperturar_anio{
			  float:left;
			  text-align:center;
			  display: inline-flex;
			  vertical-align: middle;
			  padding: 0.375rem 0.75rem;
			  font-size: 0.75rem;
			  line-height: 1.5;
			  justify-content: left;
		}
	</style>
	
</head>
<body>

<div id="containerListaRegistros" class="pl-3 pr-3">
	<div class="div_filtro">
		<div class="row">
			<div class="col-xs-12 col-4">
				<table style="width:100%">
					<tr>
						<td >
							<select class="form-control" id="cbanioapertura" >
								<option value="Todos">Año</option>
								<option value="2021">2021</option>
								<option value="2022">2022</option>
								<option value="2023">2023</option>
								<option value="2024">2024</option>
								<option value="2021">2025</option>
								<option value="2022">2026</option>
								<option value="2023">2027</option>
								<option value="2024">2028</option>
								<option value="2023">2029</option>
								<option value="2024">2030</option>
							</select>
						</td>
					</tr>
				</table>
			</div>
			<div class="col-xs-12 col-sm-4">
				<select class="form-control" id="cbestadopertura">
					<option value="Todos">Estado</option>
					<option value="Activo">Activo</option>
					<option value="Inactivo">Inactivo</option>
				</select>
			</div> 
			<div class="col-xs-12 col-sm-4 text-right">
				<input type="image" id="btnbuscarapertura" src="./images/iconos_nd/botonbuscar.svg" width="125px" />
				<input type="image" id="btnlimpiar" src="./images/iconos_nd/botonrefrescar.svg" width="32px" />
			</div>
		</div>		
	</div>
	<br>
	<div class="div_filtro">	
		<div class="p-0 m-0">
			<div class="row pt-2 pb-4 m-0">
				<div class="col-xs-12 col-sm-12">
					<table id="table_lista_aperturar_anio"  class="table table-striped display nowrap" style="width:100%">
						<thead class="cabecera_tabla">
					        <tr>
					        	<th>Nº</th>
					            <th>AÑO</th>
					            <th>NOMBRE DEL CONCURSO</th>
					            <th>1° ETAPA</th>
					            <th>2° ETAPA</th>
					            <th>3° ETAPA</th>
					            <th>4° ETAPA</th>
					            <th>5° ETAPA</th>
					            <th>6° ETAPA</th>
					            <th>7° ETAPA</th>
					            <th>ESTADO</th>
					            <th>EDITAR</th>
					        </tr>   
					    </thead>
					</table>
				</div>
				<br><br>
			</div>
		</div>
	</div>
	<br>
	<div class="row">
		<div class="col-xs-12 col-sm-12 text-right">
			<input type="button" value="Agregar" id="btnnuevoregistro" class="btn btn-primary text-white"/>
		</div>
	</div>
</div>


<div class="modal" tabindex="-1" role="dialog" id="modalexito">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <img th:src="@{./images/imagen_exito5.png}"/>&nbsp;&nbsp; <strong class="pt-1">Registro exitoso</strong>
      </div>
      <div class="modal-body" id="textoexito">
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary rounded-0" id="btncerrarmensajeexito" name="btncerrarmensajeexito">Aceptar</button>
      </div>
    </div>
  </div>
</div>

<div class="modal" tabindex="-1" role="dialog" id="modalconfirmacion">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <img th:src="@{./images/imagen_informacion11.png}" />&nbsp;&nbsp; <strong class="pt-1">Confirmacion</strong>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body" id="textoconfirmacion">
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" id="btnaceptarmensajeconfirmacion" name="btnaceptarmensajeconfirmacion">Aceptar</button>
        <button type="button" class="btn btn-outline-primary" id="btncerrarmensajeconfirmacion" name="btncerrarmensajeconfirmacion">Cerrar</button>
      </div>
    </div>
  </div>
</div>

<div class="modal" tabindex="-1" role="dialog" id="modalinformacion">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <img th:src="@{./images/imagen_informacion11.png}" />&nbsp;&nbsp; <strong class="pt-1">Alerta</strong>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body" id="textoinformacion">
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline-primary" id="btncerrarmensajeinformacion" name="btncerrarmensajeinformacion">Cerrar</button>
      </div>
    </div>
  </div>
</div>

<div class="modal" tabindex="-1" role="dialog" id="modalerror">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <img th:src="@{./images/imagen_informacion11.png}"/>&nbsp;&nbsp; <strong class="pt-1">Error</strong>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>	          
        </button>
      </div>
      <div class="modal-body" id="textoerror">
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline-primary" id="btncerrarmensajeerror" name="btncerrarmensajeerror">Cerrar</button>
      </div>
    </div>
  </div>
</div>

<div class="modal" tabindex="-1" role="dialog" id="modalimagencargando">
  <center>
  	<img th:src="@{./images/cargando.gif}" style="line-height: 200px;"/>
  </center>	  
</div>	
</body>
</html>

<script type="text/javascript">
	
	var url_base = location.origin+"/";
	var table_lista_aperturar_anio;
	var anio;
	var nombreconcurso;
	var fechainicioconcurso;
	var fechafinconcurso;
	var estado;
	var idapertura;
	var celdaseleccionada;

	$(document).ready(function(){	
		
		$("#btnlimpiar").click(function(){
			$("#cbanioapertura").val("Todos");
			$("#cbestadopertura").val("Todos");
			setTimeout(() => {        		  
				table_lista_aperturar_anio.draw();
	      	}, 200);
		});
		
		
		$("#btnbuscarapertura").click(function(){	
			setTimeout(() => {        		  
        		table_lista_aperturar_anio.draw();
        	}, 200);	
		});
		
		listar();
		
		$("#btnnuevoregistro").click(function(){
			$("#contenedor_consulta").html("<center><img src='./images/cargando.gif'/></center>");
			$.ajax({
				type : "GET",
			    url : url_base + "pedesa/nuevoregistroapertura/",
				success: function(respuesta) {
					$("#contenedor_consulta").html(respuesta);
				}
			});
		});
		
		$("#btncerrarmensajeexito").click(function(){			
			$("#modalexito").modal('hide');
		});
			
		$("#btncerrarmensajeinformacion").click(function(){
			$("#modalinformacion").modal('hide');
		});
		
		$("#btncerrarmensajeerror").click(function(){
			$("#modalerror").modal('hide');
		});
		
		$("#btncerrarmensajeconfirmacion").click(function(){
			$("#modalconfirmacion").modal('hide');
		});		
			
	});
	
	$("#fechainicioconcurso").datepicker({
		locale: 'es-es',
	    format: 'dd/mm/yyyy',
	    uiLibrary: 'bootstrap4'
	});
	$("#fechafinconcurso").datepicker({
		locale: 'es-es',
	    format: 'dd/mm/yyyy',
	    uiLibrary: 'bootstrap4'
	});
	
	var listar = function (){
		
		$("#table_lista_aperturar_anio").dataTable().fnDestroy();
		table_lista_aperturar_anio = $('#table_lista_aperturar_anio').DataTable({
			dom: '<B><"rs_aperturar_anio">frtip',
		    "scrollX": true,
		    "searching": true,
		    lengthMenu: [
		        [ 10, 15, 25, -1 ],
		        [ '10 filas', '15 filas', '25 filas', 'Mostrar todas' ]
		    ],
		    "processing":true,
		    language: {
		        "decimal": "",
		        "emptyTable": "No hay información",
		        "info": "Mostrando _START_ a _END_ de _TOTAL_ Entradas",
		        "infoEmpty": "Mostrando 0 a 0 de 0 Entradas",
		        "infoFiltered": "(Filtrado de _MAX_ total entradas)",
		        "infoPostFix": "",
		        "thousands": ",",
		        "lengthMenu": "Mostrar _MENU_ Entradas",
		        "loadingRecords": "Cargando Registros...",
		        "processing": "Procesando...",
		        "search": "_INPUT_",
		        "searchPlaceholder": "Busqueda General",
		        "zeroRecords": " ",//No existen registros
		        "paginate": {
		            "first": "Primero",
		            "last": "Ultimo",
		            "next": "Siguiente",
		            "previous": "Anterior"
		        }
		    },
		    'ajax' : {
		        "url" : url_base + 'pedesa/listaaperturaranio',
		        "type" : "GET",
		        "dataSrc" : ""
		    },
		    "deferRender": true,
		    'columnDefs': 
		    [
		    	{
	                type: 'date-euro',"targets": 3,
	                "render": function(data, type, row, meta){
	                    return moment(data).format('DD/MM/YYYY');
	                }
            	},
            	{
	                type: 'date-euro',"targets": 4,
	                "render": function(data, type, row, meta){
	                    return moment(data).format('DD/MM/YYYY');
	                }
            	},
            	{
	                type: 'date-euro',"targets": 5,
	                "render": function(data, type, row, meta){
	                    return moment(data).format('DD/MM/YYYY');
	                }
            	},
            	{
	                type: 'date-euro',"targets": 6,
	                "render": function(data, type, row, meta){
	                    return moment(data).format('DD/MM/YYYY');
	                }
            	},
            	{
	                type: 'date-euro',"targets": 7,
	                "render": function(data, type, row, meta){
	                    return moment(data).format('DD/MM/YYYY');
	                }
            	},
            	{
	                type: 'date-euro',"targets": 8,
	                "render": function(data, type, row, meta){
	                    return moment(data).format('DD/MM/YYYY');
	                }
            	},
            	{
	                type: 'date-euro',"targets": 9,
	                "render": function(data, type, row, meta){
	                    return moment(data).format('DD/MM/YYYY');
	                }
            	},
            	{
                	"targets": 11, 
                    "className": "text-center"
                }
		    ],
		    'columns' : [
		    	{ 
		    		"data": null, "render": function (data, type, full, meta) { return meta.row + 1; }
		    	},
		    	{ 'data' : 'anio' },
		        { 'data' : 'nombreconcurso' },
		        { 'data' : 'primeraetapahasta' },
		        { 'data' : 'segundaetapahasta' },
		        { 'data' : 'terceraetapahasta' },
		        { 'data' : 'cuartaetapahasta' },
		        { 'data' : 'quintaetapahasta' },
		        { 'data' : 'sextaetapahasta' },
		        { 'data' : 'septimaetapahasta' },
		        { 'data' : 'estado' },
		        { 'defaultContent' : "<img src='./images/iconos_nd/lapiz.svg' class='editar' style='width:20px; cursor:pointer' />"}
		    ],
		    buttons: []
		});
		$("div.rs_aperturar_anio").html('<strong>RESULTADOS DE APERTURAR AÑO</strong>');
		obtener_data_editar("#table_lista_aperturar_anio tbody",table_lista_aperturar_anio);
	}
	
	var obtener_data_editar = function(tbody,table){
		$(tbody).on("click","img.editar",function(){
			$('#modalimagencargando').modal({
				show : true,
				backdrop : 'static',
				keyboard:false
			});
			celdaseleccionada = table.row($(this).parents("tr")).index();
			var data = table.row($(this).parents("tr")).data();
			var id = data.id;
			$.ajax({
				type : "GET",
			    url : url_base + "pedesa/editarviewaperturaanio/"+ id,
				success: function(respuesta) {
					$("#modalimagencargando").modal('hide');
					$("#contenedor_consulta").html(respuesta);
				},
				error: function() {
					$("#modalimagencargando").modal('hide');
					$("#textoerror").html("Excepcion al cargar vista editar");
					$('#modalerror').modal({
						show : true,
						backdrop : 'static',
						keyboard:false
					});
			    }
			});
		});
	};
	
	$.fn.dataTable.ext.search.push(
   	    function( settings, data, dataIndex ) {
   	    	
   	    	if ( settings.nTable.id !== 'table_lista_aperturar_anio' ) {
   	            return true;
   	    	}   	    	
   	    	var cbanio = $("#cbanioapertura").val();
   	    	var cbestado = $("#cbestadopertura").val();   	    	
   	    	if(!filtra(cbanio,data[1]))
   	    		return false;
   	    	if(!filtra(cbestado,data[10]))
  	    		return false;
   	    	return true;
   	    }
   	);
	
	function filtra(campofiltro,campotabla){
    	if(campofiltro==="Todos" || campofiltro===undefined)
    		return true;
    	var posicion = (campotabla.toLowerCase()).indexOf(campofiltro.toLowerCase()); 
    	if(posicion != -1)
    		return  true;
    	return false;
    }
	
	function filterInt(evt,input){
	    var key = window.Event ? evt.which : evt.keyCode;    
	    var chark = String.fromCharCode(key);
	    var tempValue = input.value+chark;
	    if(key >= 47 && key <= 57){    
	        return true;
	    }
	    else{
	        return false;
	    }
	}
	
	
		
	function validarFecha(fecha){

		if(validarFormatoFecha(fecha)){
			if(existeFecha(fecha)){
				return 1;
			}
			else{
				//alert("La fecha introducida no existe.");
				return 2;
			}
		}
		else{
			//alert("El formato de la fecha es incorrecto.");
			return 3;
		}
	}

	function validarFormatoFecha(campo) {
		var RegExPattern = /^\d{1,2}\/\d{1,2}\/\d{2,4}$/;
		if ((campo.match(RegExPattern)) && (campo!='')) {
			return true;
		} 
		else {
			return false;
		}
	}

	function existeFecha(fecha){
		var fechaf = fecha.split("/");
		var day = fechaf[0];
		var month = fechaf[1];
		var year = fechaf[2];
		var date = new Date(year,month,'0');
		if((day-0)>(date.getDate()-0)){
			return false;
		}
		return month > 0 && month < 13 && year > 0 && year < 32768 && day > 0 && day <= (new Date(year, month, 0)).getDate();
	}
	
</script>