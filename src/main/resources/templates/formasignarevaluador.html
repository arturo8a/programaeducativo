<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>ProgramaEducativo</title>
    <script type="text/javascript">
		window.history.forward();
	</script>

    <!-- Bootstrap CSS CDN -->
    <link rel="stylesheet" href="../static/css/bootstrap.min.css" th:href="@{/css/bootstrap.min.css}">
    <!-- Our Custom CSS -->
    <link rel="stylesheet" href="../static/css/style.css" th:href="@{/css/style.css}">
	
    <!-- Font Awesome JS -->
    <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/solid.js" integrity="sha384-tzzSw1/Vo+0N5UhStP3bvwWPq+uvzCMfrN1fEFe+xBmv1C/AtVX5K0uZtmcHitFZ" crossorigin="anonymous"></script>
    <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/fontawesome.js" integrity="sha384-6OIrr52G08NpOFSZdxxz1xdNSndlD4vdcf/q2myIUVO0VsqaGHJsB0RaBE01VTOY" crossorigin="anonymous"></script>
	
	<!-- jQuery CDN - Slim version (=without AJAX) -->
    <!-- script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script-->
    <!-- Popper.JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js" integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ" crossorigin="anonymous"></script>
    <!-- Bootstrap JS -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js" integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm" crossorigin="anonymous"></script>
	
	<link rel="stylesheet" href="../static/css/dataTables.bootstrap4.min.css" th:href="@{/css/dataTables.bootstrap4.min.css}">
	<link rel="stylesheet" href="../static/css/responsive.bootstrap4.min.css" th:href="@{/css/responsive.bootstrap4.min.css}">
	<link rel="stylesheet" href="../static/css/editor.dataTables.min.css" th:href="@{/css/editor.dataTables.min.css}">
	<link rel="stylesheet" href="../static/css/select.dataTables.min.css" th:href="@{/css/select.dataTables.min.css}">
	<link rel="stylesheet" href="../static/css/buttons.dataTables.min.css" th:href="@{/css/buttons.dataTables.min.css}">
	<link rel="stylesheet" href="../static/css/colReorder.dataTables.min.css" th:href="@{/css/colReorder.dataTables.min.css}">
	
	<script type="text/javascript" th:src="@{/js/jquery-3.3.1.js}" ></script>
    <script type="text/javascript" th:src="@{/js/bootstrapv4.js}" ></script>
    <script type="text/javascript" th:src="@{/js/fontawesomev5.0.6.js}" ></script>
    <script type="text/javascript" th:src="@{/js/jquery-ui.js}" ></script>
	
	<script type="text/javascript" th:src="@{/js/bootstrap-select.min.js}"></script>
    <script type="text/javascript" th:src="@{/js/fontawesomev5.0.6.js}"></script>
    <script type="text/javascript" th:src="@{/js/jquery.dataTables.min.js}"></script>
    <script type="text/javascript" th:src="@{/js/dataTables.editor.min.js}"></script>
    <script type="text/javascript" th:src="@{/js/dataTables.select.min.js}"></script>
    <script type="text/javascript" th:src="@{/js/dataTables.colReorder.min.js}"></script>
    <script type="text/javascript" th:src="@{/js/dataTables.buttons.min.js}"></script>
    <script type="text/javascript" th:src="@{/js/jszip.min.js}"></script>
    <script type="text/javascript" th:src="@{/js/pdfmake.min.js}"></script>
    <script type="text/javascript" th:src="@{/js/vfs_fonts.js}"></script>
    <script type="text/javascript" th:src="@{/js/buttons.html5.min.js}"></script>
    <script type="text/javascript" th:src="@{/js/buttons.print.min.js}"></script>
    <script type="text/javascript" th:src="@{/js/dataTables.bootstrap4.min.js}"></script>
    <script type="text/javascript" th:src="@{/js/dataTables.responsive.min.js}"></script>
    <script type="text/javascript" th:src="@{/js/responsive.bootstrap4.min.js}"></script>      
    <script type="text/javascript" th:src="@{/js/dataTables.editor.min.js}"></script>
    <script type="text/javascript" th:src="@{/js/datetime.js}"></script>
    <script type="text/javascript" th:src="@{/js/moment.min.js}"></script>
	<script type="text/javascript" th:src="@{/js/datetime-moment.js}"></script>
	
	<script type="text/javascript" th:src="@{/js/jquery-ui.js}" ></script>
	
	<link rel="stylesheet" href="../static/css/style.css" th:href="@{/css/style.css}">
	<link href="../static/css/gijgo.min.css" rel="stylesheet" th:href="@{/css/gijgo.min.css}" >
	<script type="text/javascript" th:src="@{/js/gijgo.min.js}" ></script>
	<script type="text/javascript" th:src="@{/js/messages.es-es.js}"></script>
	<script type="text/javascript" th:src="@{/js/datetime-moment-order.js}"></script>
	<script type="text/javascript" th:src="@{/js/moment.js}"></script>
	<script type="text/javascript" th:src="@{/js/fichainscripcion.js}" ></script>
	
	<script type="text/javascript" th:src="@{/js/date-uk.js}"></script>
	<script type="text/javascript" th:src="@{/js/date-euro.js}"></script>    
	
	<script type="text/javascript" th:src="@{/js/btnagregarparticipante.js}"></script>  
</head>
<body>
	<form id="formparticipanteajax">
		<div class="row">
			<div class="col-xs-12 col-sm-3 text-left pt-1">
				<label for="anioasignarevaluador">Año</label>
				<input type="text" id="anioasignarevaluador" name="anioasignarevaluador" class="form-control" th:value="${anio}" disabled/> 	
			</div>
			<div class="col-xs-12 col-sm-3 text-left pt-1">
				<label for="odsasignarevaluador">ODS</label>
				<select class="form-control" id="odsasignarevaluador" name="odsasignarevaluador">
					<option value="0">Seleccione</option>
				    <option th:each="len:${ods}" th:value="${len.id}" th:utext="${len.descripcion}"/>
				</select>
			</div>
			<div class="col-xs-12 col-sm-3 text-left pt-1">
				<label for="nivelparticipacionasignarevaluador">Nivel de participación</label>
				<select class="form-control" id="nivelparticipacionasignarevaluador" name="nivelparticipacionasignarevaluador">
					<option value="0">Seleccione</option>
				    <option th:each="len:${nivelparticipacion}" th:value="${len.id}" th:utext="${len.descripcion}"/>
				</select>
			</div>
			<div class="col-xs-12 col-sm-3 text-left pt-1">
				<label for="categoriaasignarevaluador">Categoria</label>
				<select class="form-control" id="categoriaasignarevaluador" name="categoriaasignarevaluador">
					<option value="0">Seleccione</option>
				    <option th:each="len:${categoriatrabajo}" th:value="${len.id}" th:utext="${len.descripcion}"/>
				</select>
			</div>
			<div class="col-xs-12 col-sm-6 text-left pt-4">
				<label for="nombreieasignarevaluador">Nombre de la II.EE</label>
				<select class="form-control" id="nombreieasignarevaluador" name="nombreieasignarevaluador">
					<option value="0">Seleccione</option>
					<option th:each="len:${colegios}" th:value="${len.codmod}" th:utext="${len.nomie}"/>
				</select>
			</div>
			<div class="col-xs-12 col-sm-6 text-left pt-4">
				<label for="fechanacimientoestudiante">Tiene evaluadores asignados</label>
				<select class="form-control" id="tieneevaluadorasignado" name="tieneevaluadorasignado">
					<option value="0">Seleccione</option>
					<option value="1">Si</option>
					<option value="2">No</option>
				</select>
			</div>
		</div>
		<hr>
		<div class="row">
			<div class="col-xs-12 col-sm-12 text-left pt-4 w-100">
				<u>Seleccione trabajos para ser evaluados</u>
			</div>
			<div class="col-xs-12 col-sm-12 text-left pt-4">
			 	<table id="table_lista_trabajos_evaluados"  class="table table-striped display nowrap" style="width:100%">
					<thead class="cabecera_tabla">
				        <tr>
				        	<th><input type="checkbox" id="seleccionarTodotrabajosevaluados"/></th>
				        	<th>ODS</th>
							<th>CATEGORIA</th>
				            <th>NIVEL DE PARTICIPACION</th>
				            <th>CODIGO DE IIEE</th>
				            <th>NOMBRE DE IIEE</th>
				            <th>CODIGO DEL TRABAJO</th>
				            <th>MODALIDAD</th>
				            <th>TITULO DEL TRABAJO</th>
				            <th>EVALUADORES ASIGNADOS</th>
				        </tr>
				    </thead>
				</table>
			</div>
		</div>	
		
		<div class="row">
			<div class="col-xs-12 col-sm-12 text-left pt-4 w-100">
				<u>Seleccione evaluadores</u>
			</div>
			<div class="col-xs-12 col-sm-12 text-left pt-4">
			 	<table id="table_lista_evaluadores"  class="table table-striped display nowrap" style="width:100%">
					<thead class="cabecera_tabla">
				        <tr>
				        	<th><input type="checkbox" id="seleccionarTodoevaluadores"/></th>
				        	<th>ODS</th>
							<th>ROL DE ENTIDAD</th>
				            <th>ENTIDAD</th>
				            <th>APELLIDO PATERNO</th>
				            <th>APELLIDO MATERNO</th>
				            <th>NOMBRES</th>
				            <th>TIPO DOCUMENTO</th>
				            <th>N° DE DOCUMENTO</th>
				        </tr>
				    </thead>
				</table>
			</div>
		</div>	
		<br>
		<div class="row">
			<div class="col-xs-12 col-sm-6 text-right">
				<input type="button" id="btncancelarasignarevaluador" name="btncancelarasignarevaluador" class="btn btn-danger" value="CANCELAR" />
			</div>
			<div class="col-xs-12 col-sm-6 text-left">
				<input type="button" id="btnaceptarasignarevaluador" name="btnaceptarasignarevaluador" class="btn btn-primary" value="ASIGNAR" />
			</div>
		</div>
	</form>

	<div class="modal" tabindex="-1" role="dialog" id="modalimagencargando">
	  <center>
	  	<img th:src="@{./images/cargando.gif}" style="line-height: 200px;"/>
	  </center>	  
	</div>		
</body>
</html>

<script type="text/javascript">

	var url_base = location.origin+"/";		
	var celdaseleccionada;
	var id;
	var table_lista_trabajos_evaluados,table_lista_evaluadores;
	var anio, idods,idnivelparticipacion,idcategoria,idcodmod,tieneevaluadoresasignados;
	var mensajeValidacionAsignarEvaluador;
	
	$(document).ready(function(){
		
		$("#btncancelarasignarevaluador").click(function(){
			limpiar();
			$("#modalasignarevaluador").modal('hide');
		});
		
		$('#seleccionarTodotrabajosevaluados').click(function(){
			if ($(this).is(":checked")) {
				table_lista_trabajos_evaluados.rows().select();        
		    }
			else{
				table_lista_trabajos_evaluados.rows().deselect(); 
		    }
        });	
		
		$('#seleccionarTodoevaluadores').click(function(){
			if ($(this).is(":checked")) {
				table_lista_evaluadores.rows().select();        
		    }
			else{
				table_lista_evaluadores.rows().deselect(); 
		    }
        });	
		
		$("#btncerrarmensajeerrorasignarevaluador").click(function(){
			$("#modalerrorasignarevaluador").modal('hide');
		});
		
		listarTrabajosEvaluados();
		listarEvaluadores();
		
		$("#btnaceptarasignarevaluador").click(function(){
			
			/*anio = $("#anioasignarevaluador").val();
			idods = $("#odsasignarevaluador").val();
			idnivelparticipacion = $("#nivelparticipacionasignarevaluador").val();
			idcategoria = $("#categoriaasignarevaluador").val();
			idcodmod = $("#nombreieasignarevaluador").val();
			tieneevaluadoresasignados = $("#tieneevaluadorasignado").val();*/
			
			$("#modalimagencargando").modal({
				show : true,
				backdrop : 'static',
				keyboard:false
			});
			
			if(validarCamposAsignarEvaluador()){
				
				var evaluadortmp = {
					anio : anio,
					ods : {
						id : idods
					},
					nivelparticipacion : {
						id : idnivelparticipacion
					},
					categoria : {
						id : idcategoria
					},
					codmod : idcodmod,
					evaluadorasignado : tieneevaluadoresasignados
				};
				
				var array = table_lista_trabajos_evaluados.rows(".selected").data();	
				var idx="";
				for(i=0;i<array.length;i++){
					/*array_nivel.push(array[i].nivel);
					arrayParticipante.push({id : (array[i].id)});*/
					idx = array[i].id;
					console.log("id :" + idx);
				}
				
				/*var trabajosevaluados = {
						
				}
				var evaluadores = {
						
				}*/
				
			}
			else{
				$("#modalimagencargando").modal('hide');
				$("#textoerrorasignarevaluador").html("<div style='color:red' class='text-left'>"+mensajeValidacionAsignarEvaluador+"</div>");
				$('#modalerrorasignarevaluador').modal({
					show : true,
					backdrop : 'static',
					keyboard:false
				});
			}			
		});
	});
	
	var listarTrabajosEvaluados = function(){
		
		$("#table_lista_trabajos_evaluados").dataTable().fnDestroy();				
	    
		table_lista_trabajos_evaluados = $('#table_lista_trabajos_evaluados').DataTable({
			"dom": 'Bfrtip',
	        "scrollX": true,
	        "searching": true,
	        "lengthMenu": [
	            [ 10, 15, 25, -1 ],
	            [ '10 filas', '15 filas', '25 filas', 'Mostrar todas' ]
	        ],
	        "processing":true,
	        "paging": false,
	        "searching": false,
	        "language": {
	            buttons: {
	              pageLength: 'Mostrar'
	            },
	            "decimal": "",
	            "emptyTable": "No hay información",
	            "info": "",
	            "infoEmpty": "",
	            "infoFiltered": "(Filtrado de _MAX_ total entradas)",
	            "infoPostFix": "",
	            "thousands": ",",
	            "lengthMenu": "Mostrar _MENU_ Entradas",
	            "loadingRecords": "Cargando Registros...",
	            "processing": "Procesando...",
	            "search": "_INPUT_",
		        "searchPlaceholder": "Busqueda General",
	            "zeroRecords": "No existen registros"	            
	        },
	        "ajax" : {
	            "url" : url_base + 'pedesa/listaTrabajoEvaluado',
	            "type" : "GET",
	            "dataSrc" : ""
	        },
	        "columns" : [
	        	{
	        		"data":null, render:function(){return "";}
	        	},
	        	{ 'data' : 'ods' },
	        	{ 'data' : 'categoria' },
	        	{ 'data' : 'nivel_participacion' },
	        	{ 'data' : 'codigoie' },
	            { 'data' : 'nombreie' },
	            { 'data' : 'codigo_trabajo' },
	        	{ 'data' : 'modalidad' },
	        	{ 'data' : 'titulo' },
	            { 'data' : 'evaluadores_asignados' }
	        ],
	        columnDefs: [
	        	{
                    orderable: false,
                    className: 'select-checkbox',
                    targets:   0
                }
	        ],
	        select: {
	            style:    'multi', 
	            selector: 'td:first-child'
	        },
	        "buttons": []
	    });
	}
	
	var listarEvaluadores = function(){
		
		$("#table_lista_evaluadores").dataTable().fnDestroy();				
	    
		table_lista_evaluadores = $('#table_lista_evaluadores').DataTable({
			"dom": 'Bfrtip',
	        "scrollX": true,
	        "searching": true,
	        "lengthMenu": [
	            [ 10, 15, 25, -1 ],
	            [ '10 filas', '15 filas', '25 filas', 'Mostrar todas' ]
	        ],
	        "processing":true,
	        "paging": false,
	        "searching": false,
	        "language": {
	            buttons: {
	              pageLength: 'Mostrar'
	            },
	            "decimal": "",
	            "emptyTable": "No hay información",
	            "info": "",
	            "infoEmpty": "",
	            "infoFiltered": "(Filtrado de _MAX_ total entradas)",
	            "infoPostFix": "",
	            "thousands": ",",
	            "lengthMenu": "Mostrar _MENU_ Entradas",
	            "loadingRecords": "Cargando Registros...",
	            "processing": "Procesando...",
	            "search": "_INPUT_",
		        "searchPlaceholder": "Busqueda General",
	            "zeroRecords": "No existen registros"
	        },
	        "ajax" : {
	            "url" : url_base + 'pedesa/listaevaluador',
	            "type" : "GET",
	            "dataSrc" : ""
	        },
	        "columns" : [
	        	{
	        		"data":null, render:function(){return "";}
	        	},
	        	{ 'data' : 'ods' },
	        	{ 'data' : 'rol_entidad' },
	        	{ 'data' : 'entidad' },
	        	{ 'data' : 'apellido_paterno' },
	            { 'data' : 'apellido_materno' },
	            { 'data' : 'nombres' },
	        	{ 'data' : 'tipo_documento' },
	        	{ 'data' : 'nro_documento' }
	        ],
	        columnDefs: [
	        	{
                    orderable: false,
                    className: 'select-checkbox',
                    targets:   0
                }
	        ],
	        select: {
	            style:    'multi', 
	            selector: 'td:first-child'
	        },
	        "buttons": []
	    });
	}
	
	function validarCamposAsignarEvaluador(){
		
		mensajeValidacionAsignarEvaluador = "";
		anio = $("#anioasignarevaluador").val();
		idods = $("#odsasignarevaluador").val();
		idnivelparticipacion = $("#nivelparticipacionasignarevaluador").val();
		idcategoria = $("#categoriaasignarevaluador").val();
		idcodmod = $("#nombreieasignarevaluador").val();
		tieneevaluadoresasignados = $("#tieneevaluadorasignado").val();
		
		if(idods == "0"){
			mensajeValidacionAsignarEvaluador += "Debe seleccionar ODS"+"<br>";
		}
		if(idnivelparticipacion=="0"){
			mensajeValidacionAsignarEvaluador += "Debe seleccionar nivel de participación"+"<br>";
		}
		if(idcategoria=="0"){
			mensajeValidacionAsignarEvaluador += "Debe seleccionar categoria"+"<br>";
		}
		if(idcodmod=="0"){
			mensajeValidacionAsignarEvaluador += "Debe seleccionar II.EE"+"<br>";
		}
		if(tieneevaluadoresasignados=="0"){
			mensajeValidacionAsignarEvaluador += "Debe seleccionar tiene evaluadores asignados"+"<br>";
		}
		if(mensajeValidacionAsignarEvaluador!=""){
			return false;
		}
		return true;
	}
	
	
	function limpiar(){
		$("#odsasignarevaluador").val("0");
		$("#nivelparticipacionasignarevaluador").val("0");
		$("#categoriaasignarevaluador").val("0");
		$("#nombreieasignarevaluador").val("0");
		$("#tieneevaluadorasignado").val("0");
	}

</script>

