<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<meta charset="utf-8" />

<link rel="stylesheet" href="../static/css/style.css" th:href="@{/css/style.css}">
<link rel="stylesheet" href="../static/css/nuevo_disenio.css" th:href="@{/css/nuevo_disenio.css}">
<link href="../static/css/gijgo.min.css" rel="stylesheet" th:href="@{/css/gijgo.min.css}" >


<link href="../static/css/font-awesome.min.css" rel="stylesheet" th:href="@{/css/font-awesome.min.css}" >

<script type="text/javascript" th:src="@{/js/gijgo.min.js}" ></script>
<script type="text/javascript" th:src="@{/js/messages.es-es.js}"></script>
<script type="text/javascript" th:src="@{/js/datetime-moment-order.js}"></script>
<script type="text/javascript" th:src="@{/js/moment.js}"></script>

<script type="text/javascript" th:src="@{/js/date-uk.js}"></script>
<script type="text/javascript" th:src="@{/js/date-euro.js}"></script>

<script type="text/javascript" th:src="@{/js/bootstrapv4.js}" ></script>
<style>

	.excelHtml5 {
		float:left;
	}
	
	.rs_concurso_educativo{
		  float:left;
		  text-align:center;
		  display: inline-flex;
		  vertical-align: middle;
		  padding: 0.375rem 0.75rem;
		  font-size: 0.75rem;
		  line-height: 1.5;
		  justify-content: left;
	}
	
	.rs_concurso_educativo_nacional{
		  float:left;
		  text-align:center;
		  display: inline-flex;
		  vertical-align: middle;
		  padding: 0.375rem 0.75rem;
		  font-size: 0.75rem;
		  line-height: 1.5;
		  justify-content: left;
	}
	
	.rs_alianza_estrategica{
		  float:left;
		  text-align:center;
		  display: inline-flex;
		  vertical-align: middle;
		  padding: 0.375rem 0.75rem;
		  font-size: 0.75rem;
		  line-height: 1.5;
		  justify-content: left;
	}
	
	.rs_asignacion {
		  /*width:33%;*/
		  float:left;
		  text-align:center;
		  display: inline-flex;
		  vertical-align: middle;
		  padding: 0.375rem 0.75rem;
		  font-size: 0.75rem;
		  line-height: 1.5;
		  justify-content: left;
	}
</style>

<nav>
  <div class="nav nav-tabs" id="nav-tab" role="tablist" style="padding-left:30px;padding-right:30px">
    <a class="nav-item nav-link active" id="nav-concursoeducativo-tab" data-toggle="tab" href="#nav-concursoeducativo" role="tab" aria-controls="nav-concursoeducativo" aria-selected="true">Concurso escolar</a>
  </div>
</nav>
<div class="tab-content" id="nav-tabContent">
  	<div class="tab-pane fade show active" id="nav-concursoeducativo" role="tabpanel" aria-labelledby="concursoeducativo-tab">
  		<div id="containerListaRegistros" class="pl-3 pr-3 pt-2">		  		
			<div class="div_filtro">
				<div class="row pt-2 m-0">			
					<div class="col-xs-4 col-sm-2">
						<select class="form-control" id="odsconcurso" name="odsconcurso">
							<option value="Todos">ODS</option>			
							<option th:each="dato:${ods}" th:value="${dato.descripcion}" th:utext="${dato.descripcion}"/>   				    				
						</select>
					</div>
					<div class="col-xs-4 col-sm-2">
						<select class="form-control" id="anioconcurso" name="anioconcurso">
							<option value="Todos">Año</option>
							<option th:each="dato:${anios}" th:value="${dato}" th:utext="${dato}"/>
						</select>
					</div>
					<div class="col-xs-4 col-sm-2">
						<select class="form-control" id="modalidadconcurso" name="modalidadconcurso">
							<option value="Todos">Modalidad</option>	
							<option th:each="dato:${modalidadtrabajo}" th:value="${dato.descripcion}" th:utext="${dato.descripcion}"/>						
						</select>
					</div>
					<div class="col-xs-12 col-sm-2">
						<select class="form-control" id="estadoconcurso" name="estadoconcurso">
							<option value="Todos">Estado</option> 
							<option th:each="dato:${listaestadoevaluacion}" th:value="${dato.descripcion}" th:utext="${dato.descripcion}"/>		
						</select>
					</div>
					<div class="col-xs-4 col-sm-2">
						<select class="form-control" id="puestoconcurso" name="puestoconcurso">
							<option value="Todos">Puesto</option>
							<option value="1">Primer puesto</option>
							<option value="2">Segundo puesto</option>
							<option value="3">Tercer puesto</option>		    				
						</select>
					</div>
					<div class="col-xs-4 col-sm-2">
					</div>
					<div class="col-xs-4 col-sm-2 pt-3">
						<select class="form-control" id="categoriaconcurso" name="categoriaconcurso">
							<option value="Todos">Categoria</option>
							<option th:each="dato:${categoriatrabajo}" th:value="${dato.descripcion}" th:utext="${dato.descripcion}"/>			    				
						</select>
					</div>
					<div class="col-xs-4 col-sm-2 pt-3">
						<select class="form-control" id="participacionconcurso" name="participacionconcurso">
							<option value="Todos">Nivel de participación</option>
							<option th:each="dato:${nivelparticipacion}" th:value="${dato.descripcion}" th:utext="${dato.descripcion}"/>					       				
						</select>
					</div>
					<div class="col-xs-4 col-sm-2 pt-3">
						<input type="text" id="nombreieconcurso" name="nombreieconcurso" class="form-control" placeholder="Nombre de II.EE"/>
					</div>
					<div class="col-xs-12 col-sm-3 pt-3 text-right">
						<input type="image" id="btnbuscarconcurso"  src="./images/iconos_nd/botonbuscar.svg" width="125px" />
						<input type="image" id="btnlimpiarconcurso"  src="./images/iconos_nd/botonrefrescar.svg" width="32px"  />
					</div>
					
				</div>
			</div>
			<br>
			<div class="div_filtro">
				<div class="p-0 m-0">
					<div class="row pt-2 pb-4 m-0">
						<div class="col-xs-12 col-sm-12">
							<table id="table_lista_concurso"  class="table table-striped display nowrap" style="width:100%">
								<thead class="cabecera_tabla">
							        <tr>
							        	<th><input type="checkbox" id="seleccionarTodo"/></th>
							        	<th>Nº</th>
										<th>Año</th>
							            <th>Código de trabajo</th>
							            <th>ODS</th>
							            <th>Código de II.EE</th>
							            <th>Nombre de II.EE</th>
							            <th>Categoría</th>
							            <th>Modalidad</th>
							            <th>Título de trabajo</th>
							            <th>Nivel de participación</th>
							            <th>Ficha de trabajo</th>
							            <th>Evidencia</th>
							            <th>Trabajos</th>
							            <th>Permisos</th>
							            <th>Estado</th>
							            <th>Detalle de evaluación</th>
							            <th>Calificación</th>
							            <th>Puesto</th>
							        </tr>   
							    </thead>
							</table>
						</div>
						<br><br>
					</div>
				</div>
			</div>		  		
		</div>		
	</div>
	


</div>

<center>
	<div class="modal fade" tabindex="-1" role="dialog" id="modalArchivosEvidencias" aria-labelledby="myLargeModalLabel" >
	  <div class="modal-dialog modal-lg" role="document">
	    <div class="modal-content" style="overflow-y: scroll; height:650px; width:95%">
	      <div class="modal-header">
	        <strong class="pt-1">EVIDENCIAS DE TRABAJOS FINALES</strong>
	        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
	          <span aria-hidden="true">&times;</span>
	        </button>
	      </div>
	      <div class="modal-body" id="contenidoEvidencias">
	      </div>
	    </div>
	  </div>
	</div>
</center>	

<center>
	<div class="modal fade" tabindex="-1" role="dialog" id="modalArchivoTrabajo" aria-labelledby="myLargeModalLabel" >
	  <div class="modal-dialog modal-lg" role="document">
	    <div class="modal-content" style="overflow-y: scroll; height:600px; width:80%">
	      <div class="modal-header">
	        <strong class="pt-1">TRABAJO FINAL</strong>
	        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
	          <span aria-hidden="true">&times;</span>
	        </button>
	      </div>
	      <div class="modal-body" id="contenidoTrabajo">
	      </div>
	    </div>
	  </div>
	</div>
</center>	

<center>
	<div class="modal fade" tabindex="-1" role="dialog" id="modaleListaPermisos" aria-labelledby="myLargeModalLabel" >
	  <div class="modal-dialog modal-lg" role="document">
	    <div class="modal-content" style="overflow-y: scroll; height:600px;width:60%">
	      <div class="modal-header">
	        <strong class="pt-1">Permisos</strong>
	      </div>
	      <div class="modal-body" id="contenidoPermisosParticipantes">
	      </div>
	      <div class="modal-footer">
	        <button type="button" class="btn btn-outline-primary" id="btnCerrarModaleListaPermisos" name="btnCerrarModaleListaPermisos">Cerrar</button>
	      </div>
	    </div>
	  </div>
	</div>
</center>

<center>
	<div class="modal fade" tabindex="-1" role="dialog" id="modalDetalleEvaluacion" aria-labelledby="myLargeModalLabel" >
	  <div class="modal-dialog modal-lg" role="document">
	    <div class="modal-content" style="overflow-y: scroll; height:600px;width:50%">
	      <div class="modal-header">
	        <strong class="pt-1"></strong>
	      </div>
	      <div class="modal-body" id="contenidoDetalleEvaluacion">
	      </div>
	      <div class="modal-footer">
	        <button type="button" class="btn btn-outline-primary" id="btnCerrarModalDetalleEvaluacion" name="btnCerrarModalDetalleEvaluacion">Cerrar</button>
	      </div>
	    </div>
	  </div>
	</div>
</center>

<!--MODAL FINALIZAR-->
<center>
	<div class="modal fade" tabindex="-1" role="dialog" id="modalFinalizar" aria-labelledby="myLargeModalLabel" >
	  <div class="modal-dialog modal-lg" role="document" style="width:70%; height:540px">
	    <div class="modal-content" >
	      <div class="modal-header">
	        <strong class="pt-1">Finalizar Evaluación ODS</strong>
	        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
		          <span aria-hidden="true">&times;</span>	          
		        </button>
	      </div>
	      <div class="modal-body" id="contenidoFinalizar">
	      	<div class="row">
				<div class="col-xs-12 col-sm-12 text-left">
					<strong class="pt-1">FINALIZAR EVALUACION</strong>
				</div>
			</div>
	      	<div class="row">
				<div class="col-xs-12 col-sm-12 text-left">
					<input type="checkbox" name="check-todos" id="check-todos" style="margin:5px" /><label for="check-1_edit">Marcar todos</label>
				</div>
			</div>
			<div class="row" id="listaOdsPorFinalizar">
				
			</div>
			<br>
			<div class="row">
				<div class="col-xs-12 col-sm-12 text-left">
					<strong class="pt-1">DESEMPATE</strong>
				</div>
			</div>
			<div class="row">
				<div class="col-xs-12 col-sm-12 text-left">
					<input type="checkbox" name="check-todos-empates" id="check-todos-empates" style="margin:5px" /><label for="check-1_edit">Marcar todos</label>
				</div>
			</div>
			<div class="row" id="listaOdsEmpatadasPorFinalizar">
				
			</div>
			<br>
			<div class="row">
				<div class="col-xs-6 col-sm-6 text-right">
					<input type="button" id="btnCerrarFinalizar" value="Cancelar" class="btn btn-outline-primary"/>
				</div>
				<div class="col-xs-6 col-sm-6 text-left">
					<input type="button" id="btnFinalizarCierre" value="Registrar" class="btn btn-primary"/>
				</div>
			</div>	 	
	      </div>
	    </div>
	  </div>
	</div>
</center>
<!--MODAL CONFIRMAR FINALIZAR-->
<center>
	<div class="modal fade" tabindex="-1" role="dialog" id="modalConfimarCierreFinalizar" aria-labelledby="myLargeModalLabel" >
	  <div class="modal-dialog modal-lg" role="document" style="width:30%; height:540px">
	    <div class="modal-content" >
	      <div class="modal-header">
	        <strong class="pt-1">Confirmar</strong>
	      </div>
	      <div class="modal-body">
	      	<div class="row">
				<label>Se asignarán los resultados a las ODS finalizadas</label>
			</div>
			<br>
			<div class="row">
				<div class="col-xs-6 col-sm-6 text-right">
					<input type="button" id="btnCancelarCierre" value="Cancelar" class="btn btn-outline-primary"/>
				</div>
				<div class="col-xs-6 col-sm-6 text-left">
					<input type="button" id="btnConfirmarCierre" value="Confirmar" class="btn btn-primary"/>
				</div>
			</div>	 	
	      </div>
	    </div>
	  </div>
	</div>
</center>
<!--MODAL FINALIZAR NACIONAL-->
<center>
	<div class="modal fade" tabindex="-1" role="dialog" id="modalFinalizarNacional" aria-labelledby="myLargeModalLabel" >
	  <div class="modal-dialog modal-lg" role="document" style="width:70%; height:540px">
	    <div class="modal-content" >
	      <div class="modal-header">
	        <strong class="pt-1">Finalizar Evaluación ODS</strong>
	        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
		          <span aria-hidden="true">&times;</span>	          
		        </button>
	      </div>
	      <div class="modal-body" id="contenidoFinalizar">
	      	<div class="div_filtro">
				<div class="p-0 m-0">
					<div class="row pt-2 pb-4 m-0">
						<div class="col-xs-12 col-sm-12" style="overflow: scroll; height: 400px;">
							<table id="table_lista_finalizar_nacional"  class="table table-striped display nowrap" style="width:100%">
								<thead class="cabecera_tabla">
							        <tr>
							        	<th><input type="checkbox" id="seleccionarTodoNacional"/></th>
							        	<th>NIVEL</th>
										<th>CATEGORIA</th>
							            <th>ESTADO</th>
							        </tr>   
							    </thead>
							    <tbody id="listaNacionalPorFinalizar"></tbody>
							</table>
							
						</div>
						<br><br>
					</div>
				</div>
			</div>	
			<br>
			<div class="row">
				<div class="col-xs-6 col-sm-6 text-right">
					<input type="button" id="btnCerrarFinalizarNacional" value="Cancelar" class="btn btn-outline-primary"/>
				</div>
				<div class="col-xs-6 col-sm-6 text-left">
					<input type="button" id="btnFinalizarCierreNacional" value="Registrar" class="btn btn-primary"/>
				</div>
			</div>	 	
	      </div>
	    </div>
	  </div>
	</div>
</center>
<!--MODAL CONFIRMAR FINALIZAR NACIONAL-->
<center>
	<div class="modal fade" tabindex="-1" role="dialog" id="modalConfimarCierreNacionalFinalizar" aria-labelledby="myLargeModalLabel" >
	  <div class="modal-dialog modal-lg" role="document" style="width:30%; height:540px">
	    <div class="modal-content" >
	      <div class="modal-header">
	        <strong class="pt-1">Confirmar</strong>
	      </div>
	      <div class="modal-body">
	      	<div class="row">
				<label>Se asignarán los resultados a las ODS finalizadas</label>
			</div>
			<br>
			<div class="row">
				<div class="col-xs-6 col-sm-6 text-right">
					<input type="button" id="btnCancelarCierreNacional" value="Cancelar" class="btn btn-outline-primary"/>
				</div>
				<div class="col-xs-6 col-sm-6 text-left">
					<input type="button" id="btnConfirmarCierreNacional" value="Confirmar" class="btn btn-primary"/>
				</div>
			</div>	 	
	      </div>
	    </div>
	  </div>
	</div>
</center>
<div class="modal" tabindex="-1" role="dialog" id="modalimagencargando">
  <center>
  	<img th:src="@{./images/cargando.gif}" style="line-height: 200px;"/>
  </center>	  
</div>		


</html>
<script type="text/javascript" th:src="@{/js/pdfobject.min.js}"></script>
<script type="text/javascript">
		
		var url_base = location.origin+"/";		
		var celdaseleccionada;
		var celdaseleccionada_na;
		var id;
		var table_lista_concurso, table_lista_asignacion, table_lista_concurso_nacional;
		
		var ods_reporte="Todos", anio_reporte="Todos", modalidad_reporte="Todos", estado_reporte="Todos", categoria_reporte="Todos", nivel_participacion_reporte="Todos", nombre_ie_reporte="Todos",puesto_reporte="Todos";
		
		$(document).off("click",".btnInactivarUsuario");
		$(document).off("click",".btnEditarUsuario");
		
		$(document).ready(function(){
			
			/*funcionesAlianza();**/
			$("#btnbuscarconcurso").click(function(){
	        	
	        	setTimeout(() => {        		  
	        		table_lista_concurso.draw();
	        		ods_reporte = $("#odsconcurso").val();
	        		anio_reporte = $("#anioconcurso").val();
	        		modalidad_reporte = $("#modalidadconcurso").val();
	        		estado_reporte = $("#estadoconcurso").val();
	        		categoria_reporte = $("#categoriaconcurso").val();
	        		nivel_participacion_reporte = $("#participacionconcurso").val();
	        		nombre_ie_reporte = $("#nombreieconcurso").val();
	        		puesto_reporte = $("#puestoconcurso").val();
	        	}, 100);	
			});
			
			$("#btnlimpiaralianza").on("click",function(){
				$('#odsalianza').val('Todos');
				$('#anioalianza').val('Todos');
				$('#rolentidadalianza').val('Todos');
				$('#estadoalianza').val('Todos');
				table_lista_usuarios.draw();
			});
			
			$("#btnlimpiarasignacion").click(function(){
				$("#odsasignacion").val("Todos");
				$("#anioasignacion").val("Todos");
				$("#categoriaasignacion").val("Todos");				
				$("#modalidadasignacion").val("Todos");
				$("#nivelparticipacionasignacion").val("Todos");
				$("#rolentidadasignacion").val("Todos");
				$("#nombreieasignacion").val("");
				
				setTimeout(() => {        		  
					table_lista_asignacion.draw();
		      	}, 100);
			});
			
			$('#seleccionarTodo').click(function(){
				if ($(this).is(":checked")) {
					table_lista_concurso.rows().select();        
			    }
				else{
					table_lista_concurso.rows().deselect(); 
			    }
            });	
			
			$("#btnlimpiarconcurso").click(function(){
				$("#odsconcurso").val("Todos");
				$("#anioconcurso").val("Todos");
				$("#modalidadconcurso").val("Todos");
				$("#estadoconcurso").val("Todos");
				$("#categoriaconcurso").val("Todos");
				$("#participacionconcurso").val("Todos");
				$("#nombreieconcurso").val("Todos");
				$("#puestoconcurso").val("Todos");
				
				ods_reporte = $("#odsconcurso").val();
        		anio_reporte = $("#anioconcurso").val();
        		modalidad_reporte = $("#modalidadconcurso").val();
        		estado_reporte = $("#estadoconcurso").val();
        		categoria_reporte = $("#categoriaconcurso").val();
        		nivel_participacion_reporte = $("#participacionconcurso").val();
        		nombre_ie_reporte = $("#nombreieconcurso").val();
        		puesto_reporte = $("#puestoconcurso").val();
				setTimeout(() => {        		  
					table_lista_concurso.draw();
		      	}, 100);
			});
			
			listar();
			
			$("#btnbuscarasignacion").click(function(){
				setTimeout(() => {        		  
					table_lista_asignacion.draw();
	        	}, 100);	
			});
			
			$.fn.dataTable.ext.search.push(
				function( settings, data, dataIndex ) {
					if ( settings.nTable.id !== 'table_lista_asignacion' ) {
				        return true;
				    }
				    var ods = $('#odsasignacion').val();
			        var anio = $('#anioasignacion').val();
			        var categoria = $('#categoriaasignacion').val();
			        var modalidad = $('#modalidadasignacion').val();		
			        var nivel = $('#nivelparticipacionasignacion').val();		
			        var rolentidad = $('#rolentidadasignacion').val();
			        var nombreie = $('#nombreieasignacion').val();		
			        if(!filtraSelect(ods,data[3]))
						return false;
					if(!filtraSelect(anio,data[2]))
						return false;
					if(!filtraSelect(categoria,data[7]))
						return false;
					if(!filtraSelect(modalidad,data[8]))
						return false;
					if(!filtraSelect(nivel,data[9]))
						return false;
					if(!filtraSelect(rolentidad,data[10]))
						return false;
					if(!filtraNombre(nombreie,data[4]))
	    	    		return false;
					return true;
				}
			);
			
			function filtraSelect(dato,campo){console.log(dato+"-"+campo);
				if(dato==="Todos")
					return true;
				return dato===campo;
			}
			
			function filtraNombre(campofiltro,campotabla){
		    	if(campofiltro==="" || campofiltro===undefined)
		    		return true;
		    	var posicion = (campotabla.toLowerCase()).indexOf(campofiltro.toLowerCase()); 
		    	if(posicion != -1)
		    		return  true;
		    	return false;
		    }
			
		});		
		
		var listar = function(){
				
				$("#table_lista_concurso").dataTable().fnDestroy();				
			    
				table_lista_concurso = $('#table_lista_concurso').DataTable({
				"dom": '<"excelHtml5"B><"rs_concurso_educativo">frtip',
	            "scrollX": true,
	            "searching": true,
	            "lengthMenu": [
	                [ 10, 15, 25, -1 ],
	                [ '10 filas', '15 filas', '25 filas', 'Mostrar todas' ]
	            ],
	            "processing":true,
	            "language": {
	                buttons: {
	                  pageLength: 'Mostrar'
	                },
	                "decimal": "",
	                "emptyTable": "No hay información",
	                "info": "Mostrando _START_ a _END_ de _TOTAL_ Entradas",
	                "infoEmpty": "Mostrando 0 a 0 de 0 Entradas",
	                "infoFiltered": "(Filtrado de _MAX_ total entradas)",
	                "infoPostFix": "",
	                "thousands": ",",
	                "lengthMenu": "Mostrar _MENU_ Entradas",
	                "loadingRecords": "Cargando Registros...",
	                "processing": "Procesando...",
	                "search": "_INPUT_",
			        "searchPlaceholder": "Busqueda General",
	                "zeroRecords": "No existen registros",
	                "paginate": {
	                    "first": "Primero",
	                    "last": "Ultimo",
	                    "next": "Siguiente",
	                    "previous": "Anterior"
	                }
	            },
	            "ajax" : {
	                "url" : url_base + 'pedesa/listaconcurso',
	                "type" : "GET",
	                "dataSrc" : ""
	            },
	            "columns" : [
	            	{
	            		 "data":null, render:function(){return "";}
	            	},
	            	{	            	
	            		"data": null, "render": function (data, type, full, meta) { return meta.row + 1; }
	            	},
	            	{ 'data' : 'anio' },
	            	{ 'data' : 'codigotrabajo' },
	            	{ 'data' : 'ods' },
	            	{ 'data' : 'codigoie' },
	                { 'data' : 'nombreie' },
	                { 'data' : 'categoria' },
	            	{ 'data' : 'modalidad' },
	            	{ 'data' : 'titulotrabajo' },
	                { 'data' : 'nivelparticipacion' },
	                { 'defaultContent' : '<img src="./images/iconos_nd/pdf1.svg" class="fichatrabajo" style="width:20px; cursor:pointer"/>' },
	                { 'defaultContent' : '<img src="./images/svg/eye-solid.svg" class="evidencia" style="width:20px; cursor:pointer"/>' },
	                { 'defaultContent' : '<img src="./images/svg/eye-solid.svg" class="trabajo" style="width:20px; cursor:pointer"/>' },
	                { 'data' : 'id', 
	                   render: function(data, type) {
	                   		var x = '<img src="./images/svg/eye-solid.svg" onclick="openModalTrabajosPermisos('+data+')" style="width:20px; cursor:pointer"/>';
                            return x;
                        }
		        	},
	                /*{ 'defaultContent' : '<img src="./images/svg/eye-solid.svg" class="permiso" style="width:20px; cursor:pointer"/>' },*/
	                { 'data' : 'estado' },
	                { 'defaultContent' : '<img src="./images/svg/eye-solid.svg" class="ce_detalleevaluacion" style="width:20px; cursor:pointer"/>' },
	                { 'data' : 'calificacion' },
	                { 'data' : 'puesto'}
	            ],
	            columnDefs: [
	            	{
	                    orderable: false,
	                    className: 'select-checkbox',
	                    targets:   0
	                },
	                {
	            	      "targets": 11,
	            	      "className": "text-center"
	                },
	                {
	            	      "targets": 12,
	            	      "className": "text-center"
	                },
	                {
	            	      "targets": 13,
	            	      "className": "text-center"
	                },
	                {
	            	      "targets": 14,
	            	      "className": "text-center"
	                },
	                {
	            	      "targets": 16,
	            	      "className": "text-center"
	                }
	            ],
	            select: {
	                style:    'multi',
	                selector: 'td:first-child'
	            },
	            "buttons": [
	            	{
		                text:"<img src='./images/iconos_nd/excel1.svg' style='size:15px;margin:0px;padding:0px'/>",
		                action: function ( e, dt, node, config ) {
							if(nombre_ie_reporte.trim()=="")
								nombre_ie_reporte = "Todos";
							
							window.location.href = url_base + "pedesa/trabajosfinalesconcurso/"+ods_reporte+"/"+anio_reporte+"/"+modalidad_reporte+"/"+estado_reporte+"/"+categoria_reporte+"/"+nivel_participacion_reporte+"/"+nombre_ie_reporte+"/"+puesto_reporte;
		                }
		            }
	            ]
	        });
			$("div.rs_concurso_educativo").html("<strong>RESULTADOS CONCURSO EDUCATIVO</strong>");
			obtener_fichatrabajo("#table_lista_concurso tbody",table_lista_concurso);
			obtener_evidencia("#table_lista_concurso tbody",table_lista_concurso);
			obtener_trabajos("#table_lista_concurso tbody",table_lista_concurso);
			obtener_ce_detalleevaluacion("#table_lista_concurso tbody",table_lista_concurso);
		}
		
		function filtraSelect(dato,campo){console.log(dato+"-"+campo);
			if(dato==="Todos" || dato==="ODS")
				return true;
			return dato===campo;
		}
		
		function filtraSelectRol(dato,campo6,campo7,campo8,campo9){console.log(dato+":"+campo6+"-"+campo7+"-"+campo8+"-"+campo9);
			if(dato==="Todos"){
				return true;
			}else{
				if(dato==="6"){
					return "SI"===campo6;
				}else if(dato==="7"){
					return "SI"===campo7;
				}else if(dato==="8"){
					return "SI"===campo8;
				}else{
					return "SI"===campo9;
				}
			}
		}

		var obtener_fichatrabajo = function(tbody,table){
			$(tbody).on("click","img.fichatrabajo",function(){
				celdaseleccionada = table.row($(this).parents("tr")).index();
				var data = table.row($(this).parents("tr")).data();
				id = data.id;
				verfichatrabajo(id);
			});
		};
		
		var obtener_evidencia = function(tbody,table){
			$(tbody).on("click","img.evidencia",function(){
				celdaseleccionada = table.row($(this).parents("tr")).index();
				var data = table.row($(this).parents("tr")).data();
				id = data.id;
				verevidencia(id);
			});
		};
		
		var obtener_trabajos = function(tbody,table){
			$(tbody).on("click","img.trabajo",function(){
				celdaseleccionada = table.row($(this).parents("tr")).index();
				var data = table.row($(this).parents("tr")).data();
				id = data.id;
				vertrabajo(id);
			});
		};
		
		var obtener_ce_detalleevaluacion = function(tbody,table){
			$(tbody).on("click","img.ce_detalleevaluacion",function(){
				celdaseleccionada = table.row($(this).parents("tr")).index();
				var data = table.row($(this).parents("tr")).data();
				id = data.id;
				f_ce_detalleevaluacion(id);
			});
		};
		
		function f_ce_detalleevaluacion(id){
	    	
	    	$.ajax({
				type : "GET",
			    contentType : "application/json",
			    url : url_base + "pedesa/detalleverevaluacion/"+id,
				success: function(respuesta) {
					$("#contenidoDetalleEvaluacion").html(respuesta);
					$("#modalDetalleEvaluacion").modal({
						show : true,
						backdrop : 'static',
						keyboard:false
					});
				},
				error: function() {
					$("#modalimagencargando").modal('hide');
					$("#textoerror").html("Excepcion al descargar PDF");
					$('#modalerror').modal({
						show : true,
						backdrop : 'static',
						keyboard:false
					});
			    }
			});    	
	    }
		
		function verfichatrabajo(id){
	    	
	    	$.ajax({
				type : "GET",
			    contentType : "application/json",
			    url : url_base + "pedesa/descargarfichatrabajoconcursopdf/"+id,
				success: function(respuesta) {
					window.open(respuesta, '_blank');
				},
				error: function() {
					$("#modalimagencargando").modal('hide');
					$("#textoerror").html("Excepcion al descargar PDF");
					$('#modalerror').modal({
						show : true,
						backdrop : 'static',
						keyboard:false
					});
			    }
			});    	
	    }
		
		function vertrabajo(id){
			
	    	$.ajax({
				type : "GET",
			    contentType : "application/json",
			    url : url_base + "pedesa/vertrabajosevidencias/"+id,
				success: function(respuesta) {
					var objeto = respuesta;
					var archivo = objeto.archivo;
					var contenido = "<div style='width:100%'>";
					var ext = (archivo.split('.')).pop();
					ext = ext.toLowerCase();
					var mi_archivo = JSON.stringify(archivo);
					var archivo = mi_archivo.replace(/['"]+/g, '');
					var subcadena = id + "/" + archivo;
					switch(ext){
						case 'jpeg':
						case 'png':
						case 'jpg': 
							contenido += archivo + "<br><img src='../alfresco_programaeducativo/pedesa/upload_trabajos/"+subcadena+"'"+" width='70%' height='400px'/>";
							break;
						case 'pdf':
							contenido += archivo + "<br><iframe src='../alfresco_programaeducativo/pedesa/upload_trabajos/"+subcadena+"'"+" type='application/pdf' width='100%' height='600px'></<iframe>";
							break;
						case 'docx': 
							contenido += window.open('../alfresco_programaeducativo/pedesa/upload_trabajos/'+subcadena, '_blank');
							break;
						case 'mp3':
							contenido += archivo + "<br><audio controls><source src='../alfresco_programaeducativo/pedesa/upload_evidencias/"+subcadena+"'"+" width='100%' height='600px' type='audio/mp3'>Tu navegador no soporta audio HTML5.</audio>";
						break;
						case 'mp4': 
							contenido += archivo + "<br><video src='../alfresco_programaeducativo/pedesa/upload_trabajos/"+subcadena+"'"+" width='100%' height='600px' controls></<video>";
							break;
					}					
					contenido += "</div>";
					$("#contenidoTrabajo").html(contenido);
					$("#modalArchivoTrabajo").modal({
						show : true,
						backdrop : 'static',
						keyboard:false
					});
				},
				error: function() {
					$("#modalimagencargando").modal('hide');
					$("#textoerror").html("Excepcion al ver trabajo");
					$('#modalerror').modal({
						show : true,
						backdrop : 'static',
						keyboard:false
					});
			    }
			});    	
	    }	
		
		
		function verevidencia(id){
	    	
	    	$.ajax({
				type : "GET",
			    contentType : "application/json",
			    url : url_base + "pedesa/vertrabajosevidencias/"+id,
				success: function(respuesta) {
					var objeto = respuesta;
					var archivo = objeto.archivo;
					var evidencias = objeto.evidencia;
					var contenido = "<div class='row'><div class='col-xs-3 col-sm-3'><table style='width:100%'>";
					
					var evidencia_inicial;
					var ext_inicial;
					var mi_evi_inicial;
					var archivo_inicial;
					var contenido_inicial;		
								
					for(var i=0;i<evidencias.length;i++){
						if(i==0){
							evidencia_inicial = evidencias[0];
							ext_inicial = (evidencia_inicial.split('.')).pop();
							ext_inicial = ext_inicial.toLowerCase();
							mi_evi_inicial = JSON.stringify(evidencia_inicial);
							archivo_inicial = mi_evi_inicial.replace(/['"]+/g, '');
						}						
						var evidencia = evidencias[i];
						var ext = (evidencia.split('.')).pop();
						ext = ext.toLowerCase();
						var mi_evi = JSON.stringify(evidencia);
						var archivo = mi_evi.replace(/['"]+/g, '');
						
						contenido += "<tr><td style='border-bottom:1px solid #DDDDDD;padding-bottom:10px'><strong style='cursor:pointer' onclick='actualizaEvidenciaDiv("+'`'+id+'`'+","+'`'+archivo+'`'+"," +'`'+ext +'`'+")'><abbr title='"+archivo+"'>"+archivo.substr(0,40)+"</abbr></strong></td></tr>";						
					}
					
					contenido += "</table></div><div class='col-xs-9 col-sm-9'><table style='width:100%'><tr><td style='padding-bottom:10px'><div id='contenido_evidencia' style='width:100%'></div></td></tr></table></div></div>";
					$("#contenidoEvidencias").html(contenido);
					actualizaEvidenciaDiv(id,archivo_inicial,ext_inicial);
					
					$("#modalArchivosEvidencias").modal({
						show : true,
						backdrop : 'static',
						keyboard:false,
						handleUpdate: true
					});
				},
				error: function() {
					$("#modalimagencargando").modal('hide');
					$("#textoerror").html("Excepcion al ver evidencia");
					$('#modalerror').modal({
						show : true,
						backdrop : 'static',
						keyboard:false
					});
			    }
			});    	
	    }
	    
	    function actualizaEvidenciaDiv(id,archivo,extension){
			var subcadena  = id + "/" + archivo;
			switch(extension){
				case 'pdf' :  
					$("#contenido_evidencia").html("<iframe src='../alfresco_programaeducativo/pedesa/upload_evidencias/"+subcadena+"'"+" type='application/pdf' width='100%' height='600px'></<iframe>");
				break;
				case 'mp4':
					$("#contenido_evidencia").html("<video src='../alfresco_programaeducativo/pedesa/upload_evidencias/"+subcadena+"'"+" width='100%' height='600px' controls></<video>");
				break;
				case 'jpg':
				case 'png':
				case 'jpeg':
					$("#contenido_evidencia").html("<img class='img-fluid' src='../alfresco_programaeducativo/pedesa/upload_evidencias/"+subcadena+"'"+" width='100%' height='600px'/>");
					break;
				case 'mp3':
					$("#contenido_evidencia").html("<audio controls><source src='../alfresco_programaeducativo/pedesa/upload_evidencias/"+subcadena+"'"+" width='100%' height='600px' type='audio/mp3'>Tu navegador no soporta audio HTML5.</audio>");
				break;
				case 'doc':
				case 'docs':
				case 'docx':
					window.open('../alfresco_programaeducativo/pedesa/upload_evidencias/'+subcadena, '_blank');
				break;
			}
		}
	    
		$.fn.dataTable.ext.search.push(
    	    function( settings, data, dataIndex ) {
    	    	
    	    	if (settings.nTable.id !== 'table_lista_concurso'){
    	            return true;
    	        }
    	    	
    	    	var ods = $("#odsconcurso").val();
    	    	var anio = $("#anioconcurso").val();
    	    	var modalidad  = $("#modalidadconcurso").val();
    	    	var estadoconcurso = $("#estadoconcurso").val();
    	    	var categoriaconcurso = $("#categoriaconcurso").val();
    	    	var participacionconcurso = $("#participacionconcurso").val();
    	    	var nombreieconcurso = $("#nombreieconcurso").val();
    	    	var puesto = $("#puestoconcurso").val();
    	    	
    	    	if(!filtra(ods,data[4]))
    	    		return false;
    	    	if(!filtra(anio,data[2]))
    	    		return false;
    	    	if(!filtra(modalidad,data[8]))
    	    		return false;
    	    	if(!filtra(estadoconcurso,data[15]))
    	    		return false;
    	    	if(!filtra(categoriaconcurso,data[7]))
    	    		return false;
    	    	if(!filtra(participacionconcurso,data[10]))
    	    		return false;
    	    	if(!filtra(nombreieconcurso,data[6]))
    	    		return false;
    	    	if(!filtra(puesto,data[18]))
    	    		return false;
   	    		return true;
    	    }
    	);
    	
    	
		
		function filtra(campofiltro,campotabla){
	    	if(campofiltro==="Todos" || campofiltro===undefined)
	    		return true;
	    	var posicion = (campotabla.toLowerCase()).indexOf(campofiltro.toLowerCase()); 
	    	if(posicion != -1)
	    		return  true;
	    	return false;
	    }
		
		function verdocumento(id,link){
			window.open("../alfresco_programaeducativo/pedesa/upload_evidencias/"+id+"/"+link, '_blank');
		}
		
		function verdocumentotrabajo(id,link){
			window.open("../alfresco_programaeducativo/pedesa/upload_trabajos/"+id+"/"+link, '_blank');
		}
		

function openModalTrabajosPermisos(idTrabajo){
	openCargando();
	
	$.ajax({
		type : "GET",
	    contentType : "application/json",
	    url : url_base + "pedesa/opneModalTrabajosPermisos/"+idTrabajo,
		success: function(respuesta) { console.log(respuesta);
			var html ='<div class="row">';
			$.each(respuesta, function( i, value ) {
				html +='<div class="col-xs-12 col-sm-12">';
				//html += "<iframe src='../alfresco_programaeducativo/pedesa/opneModalTrabajosPermisos/"+value.nombreArchivo+"'"+" type='application/pdf' width='100%' height='600px'></<iframe>";
				html += '	'+value.nombreArchivo+'<img src="./images/svg/file-pdf-regular.svg" onclick="cargarPDF('+value.idParticiapnte+')" class="archivo" style="width:20px; cursor:pointer">';
				html +='</div>';
				
			}); 
			html += '</div>';
			html +='<div class="row">';
			html +='	<div class="col-xs-12 col-sm-12" id="sectionPdfParticipante"  style="height: 480px;"><div/>';
			html += '<div/>'
			$("#contenidoPermisosParticipantes").html(html);
			closeCargando();
			$("#modaleListaPermisos").modal();
			cargarPDF(respuesta[0].idParticiapnte);
		},
		error: function() {
			closeCargando();
			$("#textoerror").html("Excepcion al descargar PDF");
			$('#modalerror').modal({
				show : true,
				backdrop : 'static',
				keyboard:false
			});
	    }
	});  
};

function cargarPDF(id){
	openCargando();
	$.ajax({
			type : "GET",
		    contentType : "application/json",
		    url : url_base + "pedesa/fichaautorizacionpdf/"+id,
			success: function(respuesta) {
				//window.open(respuesta, '_blank');
				var viewer = $("#sectionPdfParticipante");
				PDFObject.embed(respuesta,viewer);
				closeCargando();
			},
			error: function() {
				closeCargando();
				$("#textoerror").html("Excepcion al descargar PDF");
				$('#modalerror').modal({
					show : true,
					backdrop : 'static',
					keyboard:false
				});
		    }
		});
}


function openCargando(){
	$("#modalimagencargando").modal({
		show : true,
		backdrop : 'static',
		keyboard:false
	});
}
function closeCargando(){
	$("#modalimagencargando").modal('hide');
}

$("#btnCerrarModaleListaPermisos").on('click',function(){
	$("#modaleListaPermisos").modal('hide');
});

function filtraParametro(campofiltro){
	if(campofiltro==="Todos" || campofiltro===undefined)
		return '-1';
	return campofiltro;
}



$(document).ready(function(){	

	$("#btnCerrarModalDetalleEvaluacion").on("click",function(e){
		$("#modalDetalleEvaluacion").modal('hide');
	});

});
</script>
