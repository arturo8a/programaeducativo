<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>ProgramaEducativo</title>
    <script type="text/javascript">
		window.history.forward();
	</script>

    <link rel="stylesheet" href="../static/css/bootstrap.min.css" th:href="@{/css/bootstrap.min.css}">
    
    <link rel="stylesheet" href="../static/css/style.css" th:href="@{/css/style.css}">
	
    <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/solid.js" integrity="sha384-tzzSw1/Vo+0N5UhStP3bvwWPq+uvzCMfrN1fEFe+xBmv1C/AtVX5K0uZtmcHitFZ" crossorigin="anonymous"></script>
    <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/fontawesome.js" integrity="sha384-6OIrr52G08NpOFSZdxxz1xdNSndlD4vdcf/q2myIUVO0VsqaGHJsB0RaBE01VTOY" crossorigin="anonymous"></script>
	
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js" integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js" integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm" crossorigin="anonymous"></script>
	
	<link rel="stylesheet" href="../static/css/dataTables.bootstrap4.min.css" th:href="@{/css/dataTables.bootstrap4.min.css}">
	<link rel="stylesheet" href="../static/css/responsive.bootstrap4.min.css" th:href="@{/css/responsive.bootstrap4.min.css}">
	<link rel="stylesheet" href="../static/css/editor.dataTables.min.css" th:href="@{/css/editor.dataTables.min.css}">
	<link rel="stylesheet" href="../static/css/select.dataTables.min.css" th:href="@{/css/select.dataTables.min.css}">
	<link rel="stylesheet" href="../static/css/buttons.dataTables.min.css" th:href="@{/css/buttons.dataTables.min.css}">
	<link rel="stylesheet" href="../static/css/colReorder.dataTables.min.css" th:href="@{/css/colReorder.dataTables.min.css}">
	
	<script type="text/javascript" th:src="@{/js/jquery-3.3.1.js}" ></script>
    <script type="text/javascript" th:src="@{/js/bootstrapv4.js}" ></script>
    <script type="text/javascript" th:src="@{/js/fontawesomev5.0.6.js}" ></script>
    <script type="text/javascript" th:src="@{/js/jquery-ui.js}" ></script>
    <script type="text/javascript" th:src="@{/js/aperturar_anio.js}" ></script>
	
	<script type="text/javascript" th:src="@{/js/bootstrap-select.min.js}"></script>
    <script type="text/javascript" th:src="@{/js/fontawesomev5.0.6.js}"></script>
    <script type="text/javascript" th:src="@{/js/jquery.dataTables.min.js}"></script>
    <script type="text/javascript" th:src="@{/js/dataTables.editor.min.js}"></script>
    <script type="text/javascript" th:src="@{/js/dataTables.select.min.js}"></script>
    <script type="text/javascript" th:src="@{/js/dataTables.colReorder.min.js}"></script>
    <script type="text/javascript" th:src="@{/js/dataTables.buttons.min.js}"></script>
    <script type="text/javascript" th:src="@{/js/jszip.min.js}"></script>
    <script type="text/javascript" th:src="@{/js/pdfmake.min.js}"></script>
    <script type="text/javascript" th:src="@{/js/vfs_fonts.js}"></script>
    <script type="text/javascript" th:src="@{/js/buttons.html5.min.js}"></script>
    <script type="text/javascript" th:src="@{/js/buttons.print.min.js}"></script>
    <script type="text/javascript" th:src="@{/js/dataTables.bootstrap4.min.js}"></script>
    <script type="text/javascript" th:src="@{/js/dataTables.responsive.min.js}"></script>
    <script type="text/javascript" th:src="@{/js/responsive.bootstrap4.min.js}"></script>      
    <script type="text/javascript" th:src="@{/js/dataTables.editor.min.js}"></script>
    <script type="text/javascript" th:src="@{/js/datetime.js}"></script>
    <script type="text/javascript" th:src="@{/js/moment.min.js}"></script>
	<script type="text/javascript" th:src="@{/js/datetime-moment.js}"></script>
	
	<script type="text/javascript" th:src="@{/js/jquery-ui.js}" ></script>
	
	<link rel="stylesheet" href="../static/css/style.css" th:href="@{/css/style.css}">
	<link href="../static/css/gijgo.min.css" rel="stylesheet" th:href="@{/css/gijgo.min.css}" >
	<script type="text/javascript" th:src="@{/js/gijgo.min.js}" ></script>
	<script type="text/javascript" th:src="@{/js/messages.es-es.js}"></script>
	<script type="text/javascript" th:src="@{/js/datetime-moment-order.js}"></script>
	<script type="text/javascript" th:src="@{/js/moment.js}"></script>
	
	<script type="text/javascript" th:src="@{/js/date-uk.js}"></script>
	<script type="text/javascript" th:src="@{/js/date-euro.js}"></script>
	
	<style>
		
		.rs_trabajos{
		  float:left;
		  text-align:center;
		  display: inline-flex;
		  vertical-align: middle;
		  padding: 0.375rem 0.75rem;
		  font-size: 0.75rem;
		  line-height: 1.5;
		  justify-content: left;
		}
		
		.rs_participantes_update{
		  float:left;
		  text-align:center;
		  display: inline-flex;
		  vertical-align: middle;
		  padding: 0.375rem 0.75rem;
		  font-size: 0.75rem;
		  line-height: 1.5;
		  justify-content: left;
		}
		
		table{
        	overflow-x:auto;
	    }
	    table td{
	        word-wrap: break-word;
	        max-width: 600px;
	    }
	    #table_lista_participantes_consulta td{
	        white-space: inherit;
	    }
	    
	    #table_lista_trabajos_finales_consulta td{
	    	white-space: inherit;
	    }		
	</style>	
</head>
<body>

<input type="hidden" id="ultimo_anio" name="ultimo_anio"  th:value="*{ultimo_anio}">
<input type="hidden" th:value="${docentetutor_id}" id="id" />

<div class="wrapper">
	<nav id="sidebar" class="border-right" style="background: #fafafa">
		<strong>Año</strong><br><br>
		<ul th:each="anio : ${anios}" class="list-unstyled components">
        	<li class="active" th:text="${anio}" style="border-bottom:2px solid black; cursor:pointer" th:onclick="|consultaConcursoPorAnio(${anio})|">                    
        	</li>
		</ul>  
	</nav>
	<div id="content" class="m-0 p-0">
		<nav class="navbar navbar-expand-lg" style="height:50px">
			<div class="container-fluid">
				<table style="width:100%">
					<tr>
						<td>
							<button type="button" id="sidebarCollapse_consulta" class="btn btn-info">
								 <i class="fas fa-align-left"></i>
								 <span>CONSULTA</span>
							</button>
						</td>
						<td style="float: right">
							<div class="collapse navbar-collapse" id="navbarSupportedContent">
								<input type="button" value="Ir al inicio" id="inicioconcursoconsulta" class="btn btn-primary" style="cursor: pointer"/>
							</div>
						</td>						
					</tr>
				</table>
			</div>
		</nav>
		<div id="consulta_concurso" class="m-0 p-0">
			
				<div>					
					<ul class="nav nav-tabs" id="myTab" role="tablist">
					  <li class="nav-item">
					    <a class="nav-link active" id="docente-tab_consulta" data-toggle="tab" href="#docente" role="tab" aria-controls="home" aria-selected="true">1. Datos del docente</a>
					  </li>
					  <li class="nav-item">
					    <a class="nav-link" id="participante-tab_consulta" data-toggle="tab" href="#participante" role="tab" aria-controls="participante" aria-selected="false">2. Datos de los participantes</a>
					  </li>
					  <li class="nav-item">
					    <a class="nav-link" id="trabajosfinales-tab_consulta" data-toggle="tab" href="#trabajosfinales" role="tab" aria-controls="trabajosfinales" aria-selected="false">3. Registro de trabajos finales</a>
					  </li>
					</ul>
					
					<div class="tab-content" id="myTabContent">	
						<div class="tab-pane fade show active" id="docente" role="tabpanel" aria-labelledby="docente-tab_consulta">
								  	<br><br>
								  	<div class="row m-0 p-0">
								  		<div class="col-12 text-left">
								  			<strong>Código de local I.E.</strong>	
								  			<div class="ui-widget">
								  				<input type="hidden" th:value="${docentetutor_anio}" id="anio" />
								  				<input type="text" id="codmod" style="width:100%" class="form-control" th:value="${codmod}" disabled />
								  			</div>
								  		</div>
								  	</div>
								  	<br>
									  <div class="row m-0 p-0">
									  		<div class="col-4 text-left">
									  			<label>Apellido paterno</label>	
									  			<input type="text" id="appaterno" class="form-control" style="width:100%" th:field="*{docentetutor_appaterno}" disabled/>
									  		</div>
									  		<div class="col-4 text-left">
									  			<label>Apellido materno</label>	
									  			<input type="text" id="apmaterno" class="form-control" style="width:100%" th:field="*{docentetutor_apmaterno}" disabled/>
									  		</div>
									  		<div class="col-4 text-left">
									  			<label>Nombres</label>	
									  			<input type="text" id="nombre" class="form-control" style="width:100%" th:field="*{docentetutor_nombre}" disabled/>
									  		</div>
									  </div>
									  <br>
									  <div class="row m-0 p-0">
									  		<div class="col-4 text-left">
									  			<label>Tipo de documento</label>	
									  			<input type="text" id="tipodocumento" style="width:100%" class="form-control" th:field="*{docentetutor_tipodocumento}" disabled/>
									  		</div>
									  		<div class="col-4 text-left">
									  			<label>N° de documento</label>	
									  			<input type="text" id="nrodocumento" style="width:100%" class="form-control" th:field="*{docentetutor_nrodocumento}" disabled/>
									  		</div>
									  		<div class="col-4 text-left">
									  			<label>Género</label>	
									  			<input type="text" id="genero" style="width:100%" class="form-control" th:field="*{docentetutor_genero}" disabled/>
									  		</div>
									  </div>
									  <br>
									  <div class="row m-0 p-0">
									  		<div class="col-4 text-left">
									  			<label>N° de teléfono</label>	
									  			<input type="text" id="nrotelefono" style="width:100%" class="form-control" th:field="*{docentetutor_nrotelefono}" disabled/>
									  		</div>
									  		<div class="col-4 text-left">
									  			<label>Correo electrónico</label>	
									  			<input type="text" id="correoelectronico" style="width:100%" class="form-control" th:field="*{docentetutor_correoelectronico}" disabled/>
									  		</div>
									  		<div class="col-4 text-left">
									  			<label>Responsable de registro</label>	
									  			<input type="text" id="responsable" style="width:100%" class="form-control" th:field="*{docentetutor_responsable}" disabled />
									  		</div>
									  </div>
								  		<br>
									  <div class="row m-0 p-0">
									  		<div class="col-4 text-left">
									  			<label>Curso</label>	
									  			<input type="text" id="curso" style="width:100%" class="form-control" th:field="*{docentetutor_curso}" disabled/>
									  		</div>
									  		<div class="col-4">
									  			&nbsp;
									  		</div>
									  		<div class="col-4">
									  			&nbsp;
									  		</div>
									  </div>
									  <br>
									  	<div class="row m-0 p-0">
									  		<div class="col-6 text-right">
								 				<input type="button" value="Cancelar" id="btncancelarficha" class="btn btn-outline-primary" disabled/>
											</div>
											<div class="col-6 text-left">									
												<input type="button" value="Guardar" id="btnguardardocente" class="btn btn-primary text-white" disabled/>
									 		</div>
									  	</div>
									  	<br><br><br>	  
						  	</div>
						<div class="tab-pane fade" id="participante" role="tabpanel" aria-labelledby="participante-tab_consulta">
							<div  id="container_participante">
								<div class="row m-0 p-0">
									<div class="col text-right">
										<input type="button" value="Agregar participante" id="agregarparticipante" class="btn btn-primary  m-1" disabled>
									</div>
								</div>
								<div class="row m-0 p-0">
									<div class="col-xs-12 col-sm-12">
										<table id="table_lista_participantes_consulta"  class="table table-striped table-bordered nowrap" cellspacing="0" style="width:100%">
											<thead>
										        <tr>
										        	<th>Nº</th>
										            <th>Apellido paterno</th>
										            <th>Apellido materno</th>
										            <th>Nombres</th>
										            <th>Tipo de documento</th>
										            <th>N° de documento</th>
										            <th>Categoría(s)</th>
										            <th>Modalidad(s)</th>
										            <th>Ficha de autorización</th>
										            <th>Ver</th>
										            <th>Editar</th>
										            <th>Eliminar</th>
										        </tr>
										    </thead>
										</table>
									</div>
								</div>	
							</div>
						</div>		
						<div class="tab-pane fade" id="trabajosfinales" role="tabpanel" aria-labelledby="trabajosfinales-tab_consulta" >	
							<div  id="container_trabajos_finales">
								<div class="row m-0 p-0">
									<div class="col-xs-12 col-sm-12 pt-3">
										<table id="table_lista_trabajos_finales_consulta"  class="table table-striped table-bordered nowrap" cellspacing="0" style="width:100%">
											<thead>
										        <tr>
										        	<th>Nº</th>
										            <th>Categoría</th>
										            <th>Título de trabajo final</th>
										            <th>Modalidad</th>
										            <th>Participantes</th>
										            <th>Archivos</th>
										            <th>Editar</th>
										            <th>Eliminar</th>
										            <th>Enviar trabajo</th>
										        </tr>   
										    </thead>
										</table>
									</div>
								</div>	
								<div class="row m-0 p-0">
									<div class="col text-right">
										<input type="button" value="Agregar trabajo" id="agregartrabajo" class="btn btn-success mr-3" disabled>
										<input type="button" id="finalizarparticipacion"  value="FINALIZAR PARTICIPACIÓN" class="btn btn-primary mr-3" disabled>
									</div>
								</div>
							</div>		
						</div>
					</div>
				</div>
			
			
		</div>
		<br><br>
	</div>
</div>



<div class="modal fade" tabindex="-1" role="dialog" id="modalvertrabajoconsulta">
  <div class="modal-dialog modal-lg" role="document"> 
    <div class="modal-content" style="overflow-y: scroll; width:80%; height:750px">
      <div class="modal-header">
        <strong class="pt-1">VER TRABAJO</strong>
      </div>
      <div class="modal-body" id="contenidovertrabajoconsulta">
      	
      </div>
    </div>
  </div>
</div>

<div class="modal" tabindex="-1" role="dialog" id="modalimagencargando">
  <center>
  	<img th:src="@{./images/cargando.gif}" style="line-height: 200px;"/>
  </center>	  
</div>	
</body>
</html>

<script type="text/javascript">
	
	var url_base = location.origin+"/";
	var table_lista_participantes_consulta,table_lista_trabajos_finales_consulta,celdaseleccionada,mensajeValidacion;	
	
	var data;
	var appaternoestudiante="",apmaternoestudiante="",nombreestudiante="",tipodocumentoestudiante="",nrodocumentoestudiante="",fechanacimientoestudiante="";
	var generoestudiante="",nivelestudiante="",gradoestudiante="",seccionestudiante="";
	var categoriacuento=0, categoriapoesia=0,categoriadibujopintura=0,categoriacomposicionmusical=0,categoriaahorroagua=0,modalidadpostulacionindividual=0,modalidadpostulaciongrupal=0;
	var appaternopmt="",apmaternopmt="",nombrepmt="",parentesco="",tipodocumentopmt="",nrodocumentopmt="",nrotelefonopmt="",correoelectronicopmt="";
	var celdaseleccionada,mensajeValidacion=false;
	
	var id;
	
	var anio;
	
	var obtener_data_archivo,obtener_data_ver,obtener_data_vertrabajos;
	
	var listar,listar_trabajos_finales;
	
	$(document).ready(function(){
		
		$('#sidebarCollapse_consulta').on('click',function(){
            $('#sidebar').toggleClass('active');
            $('#content').toggleClass('active');
        });
			
		$("#inicioconcursoconsulta").click(function(){
			$("#modalimagencargando").modal({
				show : true,
				backdrop : 'static',
				keyboard:false
			});
			$.ajax({
				url: url_base + "pedesa/menu_concurso",
				success: function(respuesta) {
					$("#modalimagencargando").modal('hide');
					$("#container").html(respuesta);
				},
				error: function() {
			        console.log("No se ha podido obtener la información");
			    }
			});
		});
		
		anio = $("#ultimo_anio").val();
		
		$("#docente-tab_consulta").click(function(){
			$('#myTab a[href="#home"]').tab('show');
			setTimeout(function(){
				$.ajax({
					url: url_base + "pedesa/getdocentetutor",
					method : "POST",
					data : {anio  : anio} , 
					success: function(respuesta) {
						$("#appaterno").val(respuesta.appaterno);
						$("#apmaterno").val(respuesta.apmaterno);
						$("#nombre").val(respuesta.nombre);
						$("#tipodocumento").val(respuesta.tipodocumento == undefined ? "" : respuesta.tipodocumento.descripcion);
						$("#nrodocumento").val(respuesta.nrodocumento);
						$("#genero").val(respuesta.genero == undefined ? "" :respuesta.genero.descripcion);
						$("#nrotelefono").val(respuesta.nrotelefono);
						$("#correoelectronico").val(respuesta.correoelectronico);
						$("#responsable").val(respuesta.responsable == undefined ? "" :respuesta.responsable.descripcion);
						$("#matematica").val(respuesta.curso);						
					},
					error: function() {
				        console.log("No se ha podido obtener la información");
				    }
				});
			}, 100);
		});
		
		$("#participante-tab_consulta").click(function(){
			$('#myTab a[href="#participante"]').tab('show');
			setTimeout(function(){ listar(anio); }, 100);
		});
		
		$("#trabajosfinales-tab_consulta").click(function(){
			$('#myTab a[href="#trabajosfinales"]').tab('show');
			setTimeout(function(){ listar_trabajos_finales(anio); }, 100);
		});
		
		$("#fechanacimientoestudiante").datepicker({
			locale: 'es-es',
		    format: 'dd/mm/yyyy',
		    uiLibrary: 'bootstrap4'
		});	
		
	});
	
	function consultaConcursoPorAnio(anioFoco){
		$('#myTab a[href="#docente"]').tab('show');
		setTimeout(function(){
			anio = anioFoco;
			$.ajax({
				url: url_base + "pedesa/getdocentetutor",
				method : "POST",
				data : {anio  : anio} , 
				success: function(respuesta) {
					$("#appaterno").val(respuesta.appaterno);
					$("#apmaterno").val(respuesta.apmaterno);
					$("#nombre").val(respuesta.nombre);
					$("#tipodocumento").val(respuesta.tipodocumento == undefined ? "" : respuesta.tipodocumento.descripcion);
					$("#nrodocumento").val(respuesta.nrodocumento);
					$("#genero").val(respuesta.genero == undefined ? "" :respuesta.genero.descripcion);
					$("#nrotelefono").val(respuesta.nrotelefono);
					$("#correoelectronico").val(respuesta.correoelectronico);
					$("#responsable").val(respuesta.responsable == undefined ? "" :respuesta.responsable.descripcion);
					$("#curso").val(respuesta.curso);						
				},
				error: function() {
			        console.log("No se ha podido obtener la información");
			    }
			});
		}, 100);
	}
	
	listar = function (anioSelect){
		$("#table_lista_participantes_consulta").dataTable().fnDestroy();		
		table_lista_participantes_consulta = $('#table_lista_participantes_consulta').DataTable({
			dom: '<B><"rs_participantes_update">frtip',
		    "scrollX": true,
		    "searching": true,
		    fixedHeader: {
	            header: true,
	            footer: true
	        },
		    lengthMenu: [
		        [ 10, 15, 25, -1 ],
		        [ '10 filas', '15 filas', '25 filas', 'Mostrar todas' ]
		    ],
		    "processing":true,
		    language: {
		        "decimal": "",
		        "emptyTable": "No se han registrado participantes, para agregar hacer click en el botón 'Agregar participante'",
		        "info": "Mostrando _START_ a _END_ de _TOTAL_ Entradas",
		        "infoEmpty": "Mostrando 0 a 0 de 0 Entradas",
		        "infoFiltered": "(Filtrado de _MAX_ total entradas)",
		        "infoPostFix": "",
		        "thousands": ",",
		        "lengthMenu": "Mostrar _MENU_ Entradas",
		        "loadingRecords": "Cargando Registros...",
		        "processing": "Procesando...",
		        "search": "Buscar:",
		        "zeroRecords": " ",//No existen registros
		        "paginate": {
		            "first": "Primero",
		            "last": "Ultimo",
		            "next": "Siguiente",
		            "previous": "Anterior"
		        }
		    },
		    'ajax' : {
		        "url" : url_base + 'pedesa/listaparticipantesbyanio',
		        "type" : "POST",
		        "data" : { 'anio' : anioSelect },
		        "dataSrc" : ""
		    },
		    "deferRender": true,
		    'columnDefs': [	],
		    'select': {
                //'style':    'multi', 
                'selector': 'td:first-child'
	         },
		    'columns' : [
		    	{ 
		    		"data": null, "render": function (data, type, full, meta) { return meta.row + 1; }
		    	},
		    	{ 'data' : 'appaterno' },
		        { 'data' : 'apmaterno' },
		        { 'data' : 'nombre' },
		        { 'data' : 'tipodocumento' },
		        { 'data' : 'nrodocumento' },
		        { 'data' : 'categoria' },
		        { 'data' : 'modalidad' },
		        { 'defaultContent' : '<img src="./images/svg/file-pdf-regular.svg" class="archivo" style="width:20px; cursor:pointer"/>' },
		        { 'defaultContent' : '<img src="./images/svg/file-pdf-regular.svg" class="ver" style="width:20px; cursor:pointer"/>' },
		        { 'defaultContent' : '<img src="./images/svg/edit-regular.svg" class="editar" style="width:20px; filter: invert(70%)" disabled />'},
		        { 'defaultContent' : '<img src="./images/svg/eliminar-alt-regular.svg" class="eliminar" style="width:20px; filter: invert(70%)" disabled />'}
		    ],
		    buttons: [
		    	{
		    		"text" : "Descargar el formato de autorización Aqu&iacute;",
		    		"titleAttr" : "descargar",
		    		"action" : function(){
		    			window.open('/alfresco_programaeducativo/pedesa/reportes/AUTORIZACIÓNDEPADREPARAPARTICIPACIONVIIICONCURSO.docx', '_blank');		    			
		    		}
		    	}
		    ]
		});
		obtener_data_archivo("#table_lista_participantes_consulta tbody",table_lista_participantes_consulta);
		obtener_data_ver("#table_lista_participantes_consulta tbody",table_lista_participantes_consulta);		
	}
	
	listar_trabajos_finales = function (anioSelect){					
		$("#table_lista_trabajos_finales_consulta").dataTable().fnDestroy();		
		table_lista_trabajos_finales_consulta = $('#table_lista_trabajos_finales_consulta').DataTable({
			dom: '<B><"rs_trabajos">frtip',
		    "scrollX": true,
		    "searching": true,
		    fixedHeader: {
	            header: true,
	            footer: true
	        },
		    lengthMenu: [
		        [ 10, 15, 25, -1 ],
		        [ '10 filas', '15 filas', '25 filas', 'Mostrar todas' ]
		    ],
		    "processing":true,
		    language: {
		        "decimal": "",
		        "emptyTable": "No se han registrado trabajos, para agregar hacer click en el botón 'Agregar trabajo'",
		        "info": "Mostrando _START_ a _END_ de _TOTAL_ Entradas",
		        "infoEmpty": "Mostrando 0 a 0 de 0 Entradas",
		        "infoFiltered": "(Filtrado de _MAX_ total entradas)",
		        "infoPostFix": "",
		        "thousands": ",",
		        "lengthMenu": "Mostrar _MENU_ Entradas",
		        "loadingRecords": "Cargando Registros...",
		        "processing": "Procesando...",
		        "search": "Buscar:",
		        "zeroRecords": " ",//No existen registros
		        "paginate": {
		            "first": "Primero",
		            "last": "Ultimo",
		            "next": "Siguiente",
		            "previous": "Anterior"
		        }
		    },
		    'ajax' : {
		        "url" : url_base + 'pedesa/listatrabajosfinalesbyanio',
		        "type" : "POST",
		        "data" : { 'anio' : anioSelect },
		        "dataSrc" : ""
		    },
		    "deferRender": true,
		    'columnDefs': [	],
		    'select': {
                //'style':    'multi', 
                'selector': 'td:first-child'
	         },
		    'columns' : [
		    	{ 
		    		"data": null, "render": function (data, type, full, meta) { return meta.row + 1; }
		    	},
		    	{ 'data' : 'categoria' },
		        { 'data' : 'titulo' },
		        { 'data' : 'modalidad' },
		        { 'data' : 'participantes' },
		        { 'data' : 'archivos' },
		        { 'data' : 'enviado' ,
                   render: function(data, type) { 
                   		var x = '';
                        switch (data) {
                            case 0:
                                x = '<img src="./images/svg/edit-regular.svg" style="width:20px; filter: invert(70%)" disabled />';
                                break;
                            case 1:
                            	x = '<img src="./images/svg/eye-solid.svg" class="vertrabajo" style="width:20px; cursor:pointer"/>' ;
                                break;	                                
                            case 2:
                            	x = '<img src="./images/svg/eye-solid.svg" class="vertrabajo" style="width:20px; cursor:pointer" />' ;
                                break;
                        }
                        return x;
                    }
                },
		        { 'data' : 'enviado' ,
                   render: function(data, type) { 
                   		var x = '';
                        switch (data) {
                            case 0:
                                x = '<img src="./images/svg/eliminar-alt-regular.svg" style="width:20px; filter: invert(70%)" disabled />';
                                break;
                            case 1:
                            	x = '<img src="./images/svg/eliminar-alt-regular.svg" style="width:20px; filter: invert(70%)" disabled />';
                                break;
                            case 2:
                            	x = '<img src="./images/svg/eliminar-alt-regular.svg" style="width:20px; filter: invert(70%)" disabled />';
                                break;
                        }
                        return x;
                    }
                },			        
		        { 'data' : 'enviado' ,
                   render: function(data, type) { 
                   		var x = '';
                        switch (data) {
                            case 0:
                                x = "<button type='button' class='enviartrabajo btn btn-primary' disabled>Enviar</button>";
                                break;
                            case 1:
                            	x = "Enviado";
                                break;
                            case 2:
                                x = "<button type='button' class='enviartrabajo btn btn-primary' disabled>Enviar</button>";
                                break;
                        }
                        return x;
                    }
                }
		    ],
		    buttons: []
		});
		
		$("div.rs_trabajos").html("<strong>LISTA DE TRABAJOS</strong>");
		obtener_data_vertrabajos("#table_lista_trabajos_finales_consulta tbody",table_lista_trabajos_finales_consulta);
				
	}
	
	obtener_data_archivo = function(tbody,table){
		$(tbody).on("click","img.archivo",function(){
			//console.log("table : " + table);
			//console.log("celdaseleccionada :" + celdaseleccionada);
			data = table.row($(this).parents("tr")).data();
			if(data!=undefined){
				//console.log("data1 :" + data);
				id = data.id;
				archivo(id);
			}
			
		});
	};
	
	obtener_data_ver = function(tbody,table){
		$(tbody).on("click","img.ver",function(){
			data = table.row($(this).parents("tr")).data();
			if(data!=undefined){
				id = data.id;
				verPdf(id);
			}
		});
	};
	
	obtener_data_vertrabajos = function(tbody,table){
		$(tbody).on("click","img.vertrabajo",function(){
			data = table.row($(this).parents("tr")).data();
			if(data!=undefined){
				id = data.id;
				vertrabajos(id);
			}
		});
	};
	
	function vertrabajos(id){
		
		$("#modalimagencargando").modal({
			show : true,
			backdrop : 'static',
			keyboard:false
		});
		
		$.ajax({
			type : "GET",
		    url : url_base + "pedesa/formvertrabajos/"+ id,
			success: function(respuesta) { 
				$("#modalimagencargando").modal('hide');
				$("#contenidovertrabajoconsulta").html(respuesta);
				$("#modalvertrabajoconsulta").modal({
					show : true,
					backdrop : 'static',
					keyboard:false
				});
			},
			error: function() {
				console.log("Excepcion ver trabajo");
		    }
		});
	}
	
	function archivo(id){
    	
		$.ajax({
			type : "GET",
		    contentType : "application/json",
		    url : url_base + "pedesa/fichaautorizacionpdf/"+id,
			success: function(respuesta) {
				window.open(respuesta, '_blank');
			},
			error: function() {
				$("#modalimagencargando").modal('hide');
				$("#textoerror").html("Excepcion al descargar PDF");
				$('#modalerror').modal({
					show : true,
					backdrop : 'static',
					keyboard:false
				});
		    }
		});  	
    }
	
	function verPdf(id){
    	
    	$.ajax({
			type : "GET",
		    contentType : "application/json",
		    url : url_base + "pedesa/descargarparticipantepdf/"+id,
			success: function(respuesta) {
				window.open(respuesta, '_blank');
			},
			error: function() {
				$("#modalimagencargando").modal('hide');
				$("#textoerror").html("Excepcion al descargar PDF");
				$('#modalerror').modal({
					show : true,
					backdrop : 'static',
					keyboard:false
				});
		    }
		});    	
    }
	
</script>